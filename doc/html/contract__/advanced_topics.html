<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Advanced Topics</title>
<link rel="stylesheet" href="../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.76.1">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;Contract++ 0.4.1">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;Contract++ 0.4.1">
<link rel="prev" href="tutorial.html" title="Tutorial">
<link rel="next" href="virtual_specifiers.html" title="Virtual Specifiers">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><a href="http://sourceforge.net/projects/contractpp/"><img alt="Logo" width="277" height="86" src="../../../logo.png"></a></td>
<td align="center"><a href="http://sourceforge.net/projects/contractpp/files/latest/download">Download</a></td>
<td align="center"><a href="http://sourceforge.net/apps/trac/contractpp/report/3">Bugs</a></td>
<td align="center"><a href="http://sourceforge.net/projects/contractpp/reviews/">Reviews</a></td>
<td align="center"><a href="mailto:lorcaminiti@gmail.com">Contact Us</a></td>
<td align="center"><a href="http://sourceforge.net/projects/contractpp/forums/forum/920163">Help</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tutorial.html"><img src="../../..//doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../..//doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../..//doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="virtual_specifiers.html"><img src="../../..//doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="contract__.advanced_topics"></a><a class="link" href="advanced_topics.html" title="Advanced Topics">Advanced Topics</a>
</h2></div></div></div>
<div class="toc"><dl>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.commas_and_leading_symbols_in_macros">Commas
      and Leading Symbols in Macros</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.static_assertions">Static
      Assertions</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.constant_assertions">Constant
      Assertions</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.select_assertions">Select
      Assertions</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.assertion_statements">Assertion
      Statements</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.assertion_requirements">Assertion
      Requirements</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.old_of_requirements">Old-Of
      Requirements</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.old_and_result_value_copies">Old
      and Result Value Copies</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.pure_virtual_functions">Pure
      Virtual Functions</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.subcontracting_preconditions">Subcontracting
      Preconditions</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.static_member_functions">Static
      Member Functions</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.volatile_member_functions">Volatile
      Member Functions</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.operators">Operators</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.nested_classes">Nested Classes</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.friends">Friends</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.template_specializations">Template
      Specializations</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.exception_specifications_and_function_try_blocks">Exception
      Specifications and Function-Try Blocks</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.specifying_types__no_boost_typeof_">Specifying
      Types (no Boost.Typeof)</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.block_invariants_and_loop_variants">Block
      Invariants and Loop Variants</a></span></dt>
<dt><span class="section"><a href="advanced_topics.html#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_">Contract
      Broken Handlers (Throw on Failure)</a></span></dt>
</dl></div>
<p>
      This section explains advanced usages of this library in programming contracts.
      See the <a class="link" href="grammar.html" title="Grammar">Grammar</a> section for a complete
      guide on this library syntax.
    </p>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.commas_and_leading_symbols_in_macros"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.commas_and_leading_symbols_in_macros" title="Commas and Leading Symbols in Macros">Commas
      and Leading Symbols in Macros</a>
</h3></div></div></div>
<p>
        C++ macros cannot correctly parse a macro parameter if it contains a comma
        <code class="computeroutput"><span class="special">,</span></code> that is not wrapped within
        round parenthesis <code class="computeroutput"><span class="special">()</span></code> (because
        the preprocessor interprets such a comma as separation between two distinct
        macro parameters instead that as part of one single macro parameter, see
        also <a href="http://www.boost.org/doc/libs/release/libs/utility/identity_type" target="_top">Boost.Utility/IdentityType</a>).
        Furthermore, syntactic elements specified to this library macros cannot start
        with a non-alphanumeric symbol (<code class="computeroutput"><span class="special">-</span><span class="number">1</span></code>, <code class="computeroutput"><span class="number">1.23</span></code>,
        <code class="computeroutput"><span class="string">"abc"</span></code>, <code class="computeroutput"><span class="special">::</span></code>, etc). <sup>[<a name="contract__.advanced_topics.commas_and_leading_symbols_in_macros.f0" href="#ftn.contract__.advanced_topics.commas_and_leading_symbols_in_macros.f0" class="footnote">35</a>]</sup> For example, the parameter type <code class="computeroutput"><span class="special">::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">OtherKey</span><span class="special">,</span> <span class="identifier">OtherT</span><span class="special">&gt;</span> <span class="keyword">const</span><span class="special">&amp;</span></code> cannot be passed to this library for
        two reasons: It starts with the non-alphanumeric symbol <code class="computeroutput"><span class="special">::</span></code>
        and it contains the comma <code class="computeroutput"><span class="identifier">OtherKey</span><span class="special">,</span> <span class="identifier">OtherT</span></code>
        which is not wrapped by round parenthesis.
      </p>
<p>
        The <a href="http://www.boost.org/doc/libs/release/libs/utility/identity_type" target="_top">Boost.Utility/IdentityType</a>
        macro <code class="computeroutput"><span class="identifier">BOOST_IDENTITY_TYPE</span></code>
        can be used as usual to overcome this issue. However, using the <code class="computeroutput"><span class="identifier">BOOST_IDENTITY_TYPE</span></code> macro presents two
        limitations: It makes the syntax of this library macros more cumbersome and,
        more importantly, it does not allow C++ to automatically deduce function
        template parameters (see <a href="http://www.boost.org/doc/libs/release/libs/utility/identity_type" target="_top">Boost.Utility/IdentityType</a>
        for more information). Therefore, the syntax of this library provides an
        alternative to <code class="computeroutput"><span class="identifier">BOOST_IDENTITY_TYPE</span></code>
        to handle commas and leading symbols within macro parameters:
      </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
            Commas and leading symbols can be used freely within elements of the
            syntax that already require wrapping parenthesis (e.g., non-fundamental
            parameter types <code class="computeroutput"><span class="special">(::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">OtherKey</span><span class="special">,</span> <span class="identifier">OtherT</span><span class="special">&gt;</span> <span class="keyword">const</span><span class="special">&amp;)</span></code>).
          </li>
<li class="listitem">
            Extra parenthesis can always be used to wrap elements of the syntax that
            might contain commas and leading symbols (e.g, the base class type <code class="computeroutput"><span class="keyword">public</span> <span class="special">(::</span><span class="identifier">sizeable</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;)</span></code>).
          </li>
<li class="listitem">
            Extra parenthesis can always be used to wrap value expressions so they
            can contain commas and leading symbols (e.g., a class invariants assertion
            <code class="computeroutput"><span class="special">(::</span><span class="identifier">sizeable</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">max_size</span>
            <span class="special">&gt;=</span> <span class="identifier">size</span><span class="special">()</span></code>).
          </li>
</ol></div>
<p>
        For example (see also <a href="../../../example/contracts/macro_commas_symbols_integral_map.cpp" target="_top"><code class="literal">macro_commas_symbols_integral_map.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span>
        <span class="keyword">typename</span> <span class="identifier">Key</span><span class="special">,</span>
        <span class="keyword">typename</span> <span class="identifier">T</span><span class="special">,</span> <span class="comment">// Commas in following template params.</span>
        <span class="keyword">class</span> <span class="identifier">Allocator</span><span class="special">,</span>
                <span class="keyword">default</span> <span class="special">(::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">allocator</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">Key</span> <span class="keyword">const</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;</span> <span class="special">&gt;),</span>
        <span class="special">(</span><span class="keyword">typename</span> <span class="special">::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">map</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">key_type</span><span class="special">)</span> <span class="identifier">default_key</span><span class="special">,</span>
                <span class="keyword">default</span> <span class="special">(-</span><span class="number">1</span><span class="special">)</span>
    <span class="special">)</span> <span class="identifier">requires</span><span class="special">(</span> <span class="special">(</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">Convertible</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="keyword">int</span><span class="special">&gt;)</span> <span class="special">)</span> <span class="comment">// Commas in concepts.</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">integral_map</span><span class="special">)</span>
        <span class="identifier">extends</span><span class="special">(</span> <span class="keyword">public</span> <span class="special">(::</span><span class="identifier">sizeable</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;)</span> <span class="special">)</span> <span class="comment">// Commas in bases.</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span> <span class="comment">// Commas in class invariants.</span>
        <span class="special">(::</span><span class="identifier">sizeable</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">max_size</span><span class="special">)</span> <span class="special">&gt;=</span> <span class="identifier">size</span><span class="special">()</span>
    <span class="special">)</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">map</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">less</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">&gt;,</span> <span class="identifier">Allocator</span><span class="special">&gt;::</span>
            <span class="identifier">iterator</span> <span class="identifier">iterator</span><span class="special">;</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">OtherKey</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">OtherT</span> <span class="special">)</span>
            <span class="identifier">requires</span><span class="special">(</span>
                <span class="special">(::</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">Convertible</span><span class="special">&lt;</span><span class="identifier">OtherKey</span><span class="special">,</span> <span class="identifier">Key</span><span class="special">&gt;),</span>
                <span class="special">(::</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">Convertible</span><span class="special">&lt;</span><span class="identifier">OtherT</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;)</span>
            <span class="special">)</span>
        <span class="special">(::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">iterator</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">&gt;)</span> <span class="special">(</span><span class="identifier">insert</span><span class="special">)</span> <span class="special">(</span> <span class="comment">// Commas in result and params.</span>
                <span class="special">(::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">OtherKey</span><span class="special">,</span> <span class="identifier">OtherT</span><span class="special">&gt;</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">other_value</span><span class="special">,</span>
                        <span class="keyword">default</span> <span class="special">(::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;(</span><span class="identifier">default_key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">()))</span>
            <span class="special">)</span> <span class="keyword">throw</span><span class="special">(</span> <span class="special">(::</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;)</span> <span class="special">)</span> <span class="comment">// Commas in exception specs.</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="comment">// Leading symbols in preconditions (same for commas).</span>
                <span class="special">((!</span><span class="identifier">full</span><span class="special">()))</span> <span class="comment">// LIMITATION: Two sets `((...))` (otherwise seq.).</span>
            <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="comment">// Commas in postconditions.</span>
                <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
                <span class="special">(</span><span class="keyword">typename</span> <span class="identifier">sizeable</span><span class="special">&lt;</span><span class="identifier">OtherKey</span><span class="special">,</span> <span class="identifier">OtherT</span><span class="special">&gt;::</span><span class="identifier">size_type</span><span class="special">)</span>
                        <span class="identifier">old_other_size</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span>
                                <span class="special">(</span><span class="identifier">size</span><span class="special">&lt;</span><span class="identifier">OtherKey</span><span class="special">,</span> <span class="identifier">OtherT</span><span class="special">&gt;()),</span>
                <span class="special">(::</span><span class="identifier">sizeable</span><span class="special">&lt;</span><span class="identifier">Key</span><span class="special">,</span> <span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">max_size</span><span class="special">)</span> <span class="special">&gt;=</span> <span class="identifier">size</span><span class="special">(),</span>
                <span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">old_other_size</span> <span class="special">+</span> <span class="special">(</span><span class="identifier">result</span><span class="special">.</span><span class="identifier">second</span> <span class="special">?</span> <span class="number">1</span> <span class="special">:</span> <span class="number">0</span><span class="special">)</span>
            <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="comment">// ...</span>
</pre>
<p>
      </p>
<p>
        (Concepts and other advanced constructs used in this example are explained
        in the rest of this section and in later sections of this documentation.)
      </p>
<p>
        All these extra wrapping parenthesis are optional when there is no unwrapped
        comma and no leading symbol. Programmers could chose to always program the
        extra parenthesis for consistency but it is the authors' opinion that the
        syntax is harder to read with the extra parenthesis so it is recommended
        to use them only when strictly necessary.
      </p>
<p>
        It is also recommended to avoid using commas and leading symbols whenever
        possible so to limit the cases when it is necessary to use the extra wrapping
        parenthesis. For example, in many cases the leading symbol <code class="computeroutput"><span class="special">::</span></code> might not be necessary and leading symbols
        like <code class="computeroutput"><span class="special">!</span></code> can be replaced by the
        alternative <code class="computeroutput"><span class="keyword">not</span></code> keyword. Furthermore,
        in some cases <code class="computeroutput"><span class="keyword">typedef</span></code> can be
        programmed just before class and function declarations to avoid passing types
        within multiple template parameters separated by commas. Declarations of
        class templates and function templates are the most common cases were commas
        cannot be avoided and extra wrapping parenthesis are necessarily used.
      </p>
<div class="warning"><table border="0" summary="Warning">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="../../../doc/src/images/warning.png"></td>
<th align="left">Warning</th>
</tr>
<tr><td align="left" valign="top"><p>
          Preconditions, postconditions, and class invariants composed of one single
          assertion that needs to be wrapped within extra parenthesis need to use
          double parenthesis (this should be a relatively rare case). <sup>[<a name="contract__.advanced_topics.commas_and_leading_symbols_in_macros.f1" href="#ftn.contract__.advanced_topics.commas_and_leading_symbols_in_macros.f1" class="footnote">36</a>]</sup> This is the case in the above example for <code class="computeroutput"><span class="identifier">precondition</span><span class="special">(</span> <span class="special">((!</span><span class="identifier">full</span><span class="special">()))</span> <span class="special">)</span></code> (but
          note that these extra parenthesis could have been avoided all together
          simply using <code class="computeroutput"><span class="keyword">not</span></code> instead of
          <code class="computeroutput"><span class="special">!</span></code> as in the more readable
          <code class="computeroutput"><span class="identifier">precondition</span><span class="special">(</span>
          <span class="keyword">not</span> <span class="identifier">full</span><span class="special">()</span> <span class="special">)</span></code>).
        </p></td></tr>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.static_assertions"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.static_assertions" title="Static Assertions">Static
      Assertions</a>
</h3></div></div></div>
<p>
        This library allows to use <a href="http://en.wikipedia.org/wiki/C%2B%2B11#Static_assertions" target="_top"><span class="emphasis"><em>static
        assertions</em></span></a> to program preconditions, postconditions, class
        invariants, and block invariants so that they are checked at compile-time
        instead of at run-time. The <a href="http://en.wikipedia.org/wiki/C%2B%2B11" target="_top">C++11</a>
        syntax is used (but <a href="http://www.boost.org/doc/libs/release/libs/mpl" target="_top">Boost.MPL</a>
        <code class="computeroutput"><span class="identifier">BOOST_MPL_ASSERT_MSG</span></code> is used
        to implement static assertions so no <a href="http://en.wikipedia.org/wiki/C%2B%2B11" target="_top">C++11</a>
        feature is required):
      </p>
<pre class="programlisting"><span class="identifier">static_assert</span><span class="special">(</span><span class="emphasis"><em>constant-boolean-condition</em></span><span class="special">,</span> <span class="emphasis"><em>constant-string-literal</em></span><span class="special">)</span>
</pre>
<p>
        For example (see also <a href="../../../example/contracts/static_assertion_memcopy.cpp" target="_top"><code class="literal">static_assertion_memcopy.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">To</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">From</span> <span class="special">)</span>
    <span class="special">(</span><span class="identifier">To</span><span class="special">*)</span> <span class="special">(</span><span class="identifier">memcopy</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">To</span><span class="special">*)</span> <span class="identifier">to</span><span class="special">,</span> <span class="special">(</span><span class="identifier">From</span><span class="special">*)</span> <span class="identifier">from</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span> <span class="comment">// Static assertions.</span>
            <span class="identifier">static_assert</span><span class="special">(</span><span class="keyword">sizeof</span><span class="special">(</span><span class="identifier">To</span><span class="special">)</span> <span class="special">&gt;=</span> <span class="keyword">sizeof</span><span class="special">(</span><span class="identifier">From</span><span class="special">),</span> <span class="string">"destination too small"</span><span class="special">),</span>
            <span class="comment">// Wrapping parenthesis for asserted condition with commas.</span>
            <span class="identifier">static_assert</span><span class="special">((</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">is_convertible</span><span class="special">&lt;</span><span class="identifier">From</span><span class="special">,</span> <span class="identifier">To</span><span class="special">&gt;::</span><span class="identifier">value</span><span class="special">),</span>
                    <span class="string">"incompatible types"</span><span class="special">),</span>
            <span class="identifier">to</span><span class="special">,</span> <span class="comment">// pointer not null</span>
            <span class="identifier">from</span> <span class="comment">// pointer not null</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">;</span>
</pre>
<p>
      </p>
<p>
        Static assertions are always checked at compile-time (regardless of them
        appearing in preconditions, postconditions, etc). However, static assertions
        can be selectively disabled depending on where they are specified using
        <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_NO_PRECONDITIONS.html" title="Macro CONTRACT_CONFIG_NO_PRECONDITIONS">CONTRACT_CONFIG_NO_PRECONDITIONS</a></code>,
        <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_NO_POSTCONDITIONS.html" title="Macro CONTRACT_CONFIG_NO_POSTCONDITIONS">CONTRACT_CONFIG_NO_POSTCONDITIONS</a></code>,
        etc so it is still important to logically associate them with preconditions,
        postconditions, etc.
      </p>
<p>
        The string message passed as the second parameter of <code class="computeroutput"><span class="identifier">static_assert</span></code>
        is ignored by the current implementation of this library (but it could be
        used by future revisions of this library that take advantage of <a href="http://en.wikipedia.org/wiki/C%2B%2B11" target="_top">C++11</a>
        features). It is recommended to always specify meaningful messages for static
        assertions to increase the readability and documentation of contracts. Similarly,
        it might be useful to put a short code comment following each assertions
        (<code class="computeroutput"><span class="comment">// pointer not null</span></code>, etc) to
        increase contract readability and documentation. <sup>[<a name="contract__.advanced_topics.static_assertions.f0" href="#ftn.contract__.advanced_topics.static_assertions.f0" class="footnote">37</a>]</sup>
      </p>
<p>
        In case of a static assertion failure, this library will generated a compile-time
        error containing text similar to the following:
      </p>
<pre class="programlisting">static_assertion_memcopy.cpp:18 ... ERROR_statically_checked_precondition_number_1_failed_at_line_18 ...
</pre>
<p>
        This message is similar to the run-time assertion errors generated by this
        library, note how it contains all the information to uniquely identify the
        assertion that failed.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.constant_assertions"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.constant_assertions" title="Constant Assertions">Constant
      Assertions</a>
</h3></div></div></div>
<p>
        As explained in the <a class="link" href="contract_programming_overview.html#contract__.contract_programming_overview.constant_correctness" title="Constant-Correctness">Constant-Correctness</a>
        section, contract assertions shall not change the state of the program because
        contracts are only supposed to check (and not alter) the state of the program.
        This library automatically makes member functions, function parameters, function
        result, and old values constant so the compiler will correctly generate an
        error if assertions mistakenly try to change the object, the function parameters,
        the function result, or the old values (this should be sufficient in most
        cases when programming contracts).
      </p>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="../../../doc/src/images/important.png"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>
          This library cannot automatically make constant other variables that might
          be accessible by the contract assertions (e.g., global and static variables).
          <sup>[<a name="contract__.advanced_topics.constant_assertions.f0" href="#ftn.contract__.advanced_topics.constant_assertions.f0" class="footnote">38</a>]</sup>
        </p></td></tr>
</table></div>
<p>
        This library provides <span class="emphasis"><em>constant assertions</em></span> that can be
        used by programmers to explicitly make constant the variables used by the
        asserted condition:
      </p>
<pre class="programlisting"><span class="keyword">const</span><span class="special">(</span> <span class="emphasis"><em>variable1</em></span><span class="special">,</span> <span class="emphasis"><em>variable2</em></span><span class="special">,</span> <span class="special">...)</span> <span class="emphasis"><em>boolean-expression-using-variable1-variable2-...</em></span>
</pre>
<p>
        The following example calculates the next even and odd numbers that are stored
        (for some reason) in a global variable and static data member respectively
        (see also <a href="../../../example/contracts/const_assertion_number.cpp" target="_top"><code class="literal">const_assertion_number.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">unsigned</span> <span class="identifier">even</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>

<span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">number</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="identifier">odd</span><span class="special">;</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">next</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span>
                <span class="keyword">auto</span> <span class="identifier">old_even</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">even</span><span class="special">,</span>
                <span class="keyword">auto</span> <span class="identifier">old_odd</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">odd</span><span class="special">,</span>
                <span class="comment">// `[old_]even` and `[old_]odd` all `const&amp;` within assertions.</span>
                <span class="keyword">const</span><span class="special">(</span> <span class="identifier">even</span><span class="special">,</span> <span class="identifier">old_even</span> <span class="special">)</span> <span class="identifier">even</span> <span class="special">==</span> <span class="identifier">old_even</span> <span class="special">+</span> <span class="number">2</span><span class="special">,</span>
                <span class="keyword">const</span><span class="special">(</span> <span class="identifier">odd</span><span class="special">,</span> <span class="identifier">old_odd</span> <span class="special">)</span> <span class="identifier">odd</span> <span class="special">==</span> <span class="identifier">old_odd</span> <span class="special">+</span> <span class="number">2</span>
            <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">even</span> <span class="special">+=</span> <span class="number">2</span><span class="special">;</span>
        <span class="identifier">odd</span> <span class="special">+=</span> <span class="number">2</span><span class="special">;</span>
    <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">unsigned</span> <span class="identifier">number</span><span class="special">::</span><span class="identifier">odd</span> <span class="special">=</span> <span class="number">1</span><span class="special">;</span>
</pre>
<p>
      </p>
<p>
        Note know the postconditions use constant assertions to force the <code class="computeroutput"><span class="identifier">even</span></code> and <code class="computeroutput"><span class="identifier">odd</span></code>
        variables to be constant within each boolean expression that evaluates the
        assertion. If for example the assignment operator <code class="computeroutput"><span class="special">=</span></code>
        were mistakenly used instead of the equality operator <code class="computeroutput"><span class="special">==</span></code>
        in the above postconditions, the compiler would correctly generate an error.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.select_assertions"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.select_assertions" title="Select Assertions">Select
      Assertions</a>
</h3></div></div></div>
<p>
        In the <a class="link" href="tutorial.html" title="Tutorial">Tutorial</a> section we have
        used the ternary operator <code class="computeroutput"><span class="special">:?</span></code>
        to program assertions that are guarded by a boolean condition:
      </p>
<pre class="programlisting"><span class="identifier">old_found</span> <span class="special">?</span> <span class="keyword">true</span> <span class="special">:</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">find</span><span class="special">(</span><span class="identifier">begin</span><span class="special">(),</span> <span class="identifier">end</span><span class="special">(),</span> <span class="identifier">id</span><span class="special">)</span> <span class="special">!=</span> <span class="identifier">end</span><span class="special">(),</span>
<span class="identifier">old_found</span> <span class="special">?</span> <span class="keyword">true</span> <span class="special">:</span> <span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">old_size</span> <span class="special">+</span> <span class="number">1</span>
</pre>
<p>
        However, in cases like this one when the same boolean condition guards multiple
        assertions, it might be more efficient to evaluate the guard condition only
        once using one <span class="emphasis"><em>select assertion</em></span> instead of multiple
        ternary operators <code class="computeroutput"><span class="special">:?</span></code>. In addition,
        some programmers might find the select assertion syntax more readable than
        the ternary operator <code class="computeroutput"><span class="special">:?</span></code>. For
        example, the above guarded assertions could have been programmed using select
        assertions as:
      </p>
<pre class="programlisting"><span class="keyword">if</span><span class="special">(</span><span class="keyword">not</span> <span class="identifier">old_found</span><span class="special">)</span> <span class="special">(</span> <span class="comment">// Guard condition evaluated only once.</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">find</span><span class="special">(</span><span class="identifier">begin</span><span class="special">(),</span> <span class="identifier">end</span><span class="special">(),</span> <span class="identifier">id</span><span class="special">)</span> <span class="special">!=</span> <span class="identifier">end</span><span class="special">(),</span>
    <span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">old_size</span> <span class="special">+</span> <span class="number">1</span>
<span class="special">)</span>
</pre>
<p>
        Select assertion allow to specify an optional else-block:
      </p>
<pre class="programlisting"><span class="keyword">if</span><span class="special">(</span><span class="emphasis"><em>boolean-condition</em></span><span class="special">)</span> <span class="special">(</span>   <span class="comment">// Round parenthesis `()`.</span>
    <span class="special">...</span>                   <span class="comment">// Comma-separated assertions.</span>
<span class="special">)</span> <span class="keyword">else</span> <span class="special">(</span>                  <span class="comment">// Else optional as usual.</span>
    <span class="special">...</span>                   <span class="comment">// Comma-separated assertions.</span>
<span class="special">)</span>
</pre>
<p>
        Note that round parenthesis <code class="computeroutput"><span class="special">(</span> <span class="special">...</span> <span class="special">)</span></code> are
        used to program the then-block and else-block instead of the usual C++ curly
        parenthesis <code class="computeroutput"><span class="special">{</span> <span class="special">...</span>
        <span class="special">}</span></code>: Select assertions can be nested
        into one another (the <code class="computeroutput"><a class="link" href="../CONTRACT_LIMIT_NESTED_SELECT_ASSERTIONS.html" title="Macro CONTRACT_LIMIT_NESTED_SELECT_ASSERTIONS">CONTRACT_LIMIT_NESTED_SELECT_ASSERTIONS</a></code>
        macro specifies the maximum nesting level for select assertions).
      </p>
<p>
        For example, consider the postconditions of the following function which
        calculates the factorial of a natural number (see also <a href="../../../example/contracts/select_assertion_factorial.cpp" target="_top"><code class="literal">select_assertion_factorial.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">int</span> <span class="special">(</span><span class="identifier">factorial</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">int</span> <span class="identifier">n</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">n</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
            <span class="identifier">result</span> <span class="special">&gt;=</span> <span class="number">1</span><span class="special">,</span>
            <span class="keyword">if</span><span class="special">(</span><span class="identifier">n</span> <span class="special">==</span> <span class="number">0</span> <span class="special">||</span> <span class="identifier">n</span> <span class="special">==</span> <span class="number">1</span><span class="special">)</span> <span class="special">(</span> <span class="comment">// Select assertion, if-then statement.</span>
                <span class="identifier">result</span> <span class="special">==</span> <span class="number">1</span>
            <span class="special">)</span> <span class="keyword">else</span> <span class="special">(</span> <span class="comment">// Select assertion, else statement (optional).</span>
                <span class="comment">// Assertions disabled within assertion so recursion OK.</span>
                <span class="identifier">result</span> <span class="special">==</span> <span class="identifier">n</span> <span class="special">*</span> <span class="identifier">factorial</span><span class="special">(</span><span class="identifier">n</span> <span class="special">-</span> <span class="number">1</span><span class="special">)</span>
            <span class="special">)</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">if</span><span class="special">(</span><span class="identifier">n</span> <span class="special">==</span> <span class="number">0</span> <span class="special">||</span> <span class="identifier">n</span> <span class="special">==</span> <span class="number">1</span><span class="special">)</span> <span class="keyword">return</span> <span class="number">1</span><span class="special">;</span>
    <span class="keyword">else</span> <span class="keyword">return</span> <span class="identifier">n</span> <span class="special">*</span> <span class="identifier">factorial</span><span class="special">(</span><span class="identifier">n</span> <span class="special">-</span> <span class="number">1</span><span class="special">);</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        Using the same syntax used for constant assertions, it is possible to force
        all variables (global, static, etc) used to evaluate the if-condition of
        the select assertion to be constant (see also <a href="../../../example/contracts/const_select_assertion_factorial.cpp" target="_top"><code class="literal">const_select_assertion_factorial.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">n</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>

<span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">int</span> <span class="special">(</span><span class="identifier">factorial</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span> <span class="keyword">const</span><span class="special">(</span> <span class="identifier">n</span> <span class="special">)</span> <span class="identifier">n</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
            <span class="keyword">if</span><span class="special">(</span><span class="keyword">const</span><span class="special">(</span> <span class="identifier">n</span> <span class="special">)</span> <span class="identifier">n</span> <span class="special">==</span> <span class="special">-</span><span class="number">1</span> <span class="special">||</span> <span class="identifier">n</span> <span class="special">==</span> <span class="number">0</span><span class="special">)</span> <span class="special">(</span> <span class="comment">// Constant-correct if-condition.</span>
                <span class="identifier">result</span> <span class="special">==</span> <span class="number">1</span>
            <span class="special">)</span> <span class="keyword">else</span> <span class="special">(</span>
                <span class="identifier">result</span> <span class="special">&gt;=</span> <span class="number">1</span>
            <span class="special">)</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">int</span> <span class="identifier">m</span> <span class="special">=</span> <span class="identifier">n</span><span class="special">;</span>
    <span class="keyword">if</span><span class="special">(</span><span class="identifier">m</span> <span class="special">==</span> <span class="number">0</span> <span class="special">||</span> <span class="identifier">m</span> <span class="special">==</span> <span class="number">1</span><span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="number">1</span><span class="special">;</span>
    <span class="special">}</span> <span class="keyword">else</span> <span class="special">{</span>
        <span class="special">--</span><span class="identifier">n</span><span class="special">;</span>
        <span class="keyword">return</span> <span class="identifier">m</span> <span class="special">*</span> <span class="identifier">factorial</span><span class="special">();</span>
    <span class="special">}</span>
<span class="special">}</span>
</pre>
<p>
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.assertion_statements"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.assertion_statements" title="Assertion Statements">Assertion
      Statements</a>
</h3></div></div></div>
<p>
        Only assertions can be programmed within the contracts while normal C++ statements
        are not allowed. This is keeps contracts simple making programming errors
        within the contracts less likely and therefore increasing the probably that
        error-free contracts can properly check the correctness of the implementation.
      </p>
<p>
        However, <code class="computeroutput"><span class="keyword">using</span></code> directives,
        <code class="computeroutput"><span class="keyword">namespace</span></code> aliases, and <code class="computeroutput"><span class="keyword">typedef</span></code> statements are allowed within the
        contracts because they only affect compilation (not altering the state of
        the program at run-time) and they can be used to write more readable contracts
        (for example, shortening namespaces within contract assertions). When used,
        these statements have affect only locally within the preconditions, postconditions,
        class invariants, etc where they appear. <sup>[<a name="contract__.advanced_topics.assertion_statements.f0" href="#ftn.contract__.advanced_topics.assertion_statements.f0" class="footnote">39</a>]</sup>
      </p>
<p>
        For example (see also <a href="../../../example/contracts/assertion_statement_ialloc.cpp" target="_top"><code class="literal">assertion_statement_ialloc.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="special">(</span><span class="identifier">T</span><span class="special">*)</span> <span class="special">(</span><span class="identifier">ialloc</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span>
            <span class="keyword">namespace</span> <span class="identifier">mpl</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">mpl</span><span class="special">,</span> <span class="comment">// Assertion's namespace aliasing.</span>
            <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="identifier">std</span><span class="special">,</span> <span class="comment">// Assertion's using directive.</span>
            <span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="identifier">allocator</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">pointer</span> <span class="identifier">ptr</span><span class="special">,</span> <span class="comment">// And type definition.</span>
            <span class="identifier">static_assert</span><span class="special">(</span>
                  <span class="special">(</span><span class="identifier">mpl</span><span class="special">::</span><span class="identifier">or_</span><span class="special">&lt;</span>
                      <span class="identifier">mpl</span><span class="special">::</span><span class="identifier">bool_</span><span class="special">&lt;</span><span class="keyword">sizeof</span><span class="special">(</span><span class="identifier">T</span><span class="special">)</span> <span class="special">&lt;=</span> <span class="keyword">sizeof</span><span class="special">(</span><span class="keyword">int</span><span class="special">)&gt;</span>
                    <span class="special">,</span> <span class="identifier">mpl</span><span class="special">::</span><span class="identifier">bool_</span><span class="special">&lt;</span><span class="keyword">sizeof</span><span class="special">(</span><span class="identifier">ptr</span><span class="special">)</span> <span class="special">&lt;=</span> <span class="keyword">sizeof</span><span class="special">(</span><span class="keyword">int</span><span class="special">*)&gt;</span>
                  <span class="special">&gt;::</span><span class="identifier">value</span><span class="special">)</span>
                <span class="special">,</span> <span class="string">"within max size"</span>
            <span class="special">)</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">return</span> <span class="keyword">static_cast</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">*&gt;(</span><span class="identifier">malloc</span><span class="special">(</span><span class="keyword">sizeof</span><span class="special">(</span><span class="identifier">T</span><span class="special">)));</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        These statements follow their usual C++ syntax but they are terminated with
        a comma <code class="computeroutput"><span class="special">,</span></code> instead of a semicolon
        <code class="computeroutput"><span class="special">;</span></code>. (The <code class="computeroutput"><span class="identifier">BOOST_IDENTITY_TYPE</span></code>
        macro can be used to wrap eventual commas within the <code class="computeroutput"><span class="keyword">typedef</span></code>
        statement.)
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.assertion_requirements"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.assertion_requirements" title="Assertion Requirements">Assertion
      Requirements</a>
</h3></div></div></div>
<p>
        In general, programming contract assertions can introduce a new set of requirements
        on the types used by the program. Some of these type requirements might be
        necessary only to program the assertions and they might not be required by
        the implementation itself. In such cases, if the code is compiled with contracts
        disabled (<code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_NO_PRECONDITIONS.html" title="Macro CONTRACT_CONFIG_NO_PRECONDITIONS">CONTRACT_CONFIG_NO_PRECONDITIONS</a></code>,
        etc), the program might compile but it might no longer compile when contracts
        are enabled because some of the types do not provide all the operations necessary
        to check the contract assertions.
      </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
            More in general, in some cases it might be acceptable or even desirable
            to cause a compile-time error when a program uses types that do not provide
            all the operations needed to check the contracts (because it is not possible
            to fully check the correctness of the program). In these cases, programmers
            specify contract assertions as we have seen so far (and maybe even use
            concepts to explicitly specify the contract type requirements, see the
            <a class="link" href="concepts.html" title="Concepts">Concepts</a> section).
          </li>
<li class="listitem">
            However, in other cases it might be desirable that adding contracts to
            a program does not change its type requirements and that assertions are
            simply not checked when the types do not provide all the operations necessary
            to evaluate the asserted conditions. In these cases, programmers can
            use <span class="emphasis"><em>assertion requirements</em></span> to disable compilation
            and run-time checking of specific assertions: <sup>[<a name="contract__.advanced_topics.assertion_requirements.f0" href="#ftn.contract__.advanced_topics.assertion_requirements.f0" class="footnote">40</a>]</sup>
          </li>
</ol></div>
<pre class="programlisting"><span class="emphasis"><em>assertion</em></span><span class="special">,</span> <span class="identifier">requires</span> <span class="emphasis"><em>constant-boolean-expression</em></span>
</pre>
<p>
        (The constant boolean expression of an assertion requirement can be wrapped
        within round parenthesis <code class="computeroutput"><span class="special">()</span></code>
        if it contains unwrapped commas.)
      </p>
<p>
        Let's consider the STL <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span></code>
        class template. This template normally does not require the value type <code class="computeroutput"><span class="identifier">T</span></code> to be <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>
        (i.e., to have an equality operator <code class="computeroutput"><span class="special">==</span></code>),
        it only requires <code class="computeroutput"><span class="identifier">T</span></code> to be
        <a href="http://www.boost.org/doc/libs/release/libs/utility/CopyConstructible.html" target="_top"><code class="literal">CopyConstructible</code></a>
        (i.e., to have a copy constructor). However, in order to check the following
        <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">push_back</span></code> postcondition:
      </p>
<pre class="programlisting"><span class="identifier">back</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span> <span class="comment">// Compiler error if not `EqualityComparable&lt;T&gt;`.</span>
</pre>
<p>
        The type <code class="computeroutput"><span class="identifier">T</span></code> must to be <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>.
        Therefore, the <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>
        requirement on <code class="computeroutput"><span class="identifier">T</span></code> is introduced
        only by the contract assertions and it is not required by the <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span></code>
        implementation.
      </p>
<p>
        In some cases, programmers might want compilation to fail when <code class="computeroutput"><span class="identifier">T</span></code> is not <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>
        because in these cases it is not possible to fully check the <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span></code>
        contract and therefore its correctness (in these cases programmers do not
        specify assertion requirements and let the compilation fail, or even better
        programmers can explicitly specify the assertion type requirements using
        concepts which will also fail compilation but hopefully with more informative
        error messages, see the <a class="link" href="concepts.html" title="Concepts">Concepts</a>
        section).
      </p>
<p>
        However, in other cases programmers might want to use the contracted version
        of <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span></code> exactly
        as they use the non-contracted version of the template and therefore without
        failing compilation if <code class="computeroutput"><span class="identifier">T</span></code>
        is not <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>.
        This can be achieved specifying assertion requirements for the <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">push_back</span></code> postcondition:
      </p>
<pre class="programlisting"><span class="identifier">back</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span><span class="special">,</span> <span class="identifier">requires</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span> <span class="comment">// No error if not `EqualityComparable&lt;T&gt;`.</span>
</pre>
<p>
        This postcondition will be checked only when <code class="computeroutput"><span class="identifier">T</span></code>
        is <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>,
        otherwise the postcondition will be ignored otherwise causing no compilation
        error.
      </p>
<p>
        For example (see also <a href="../../../example/contracts/assertion_requirements_push_back.cpp" target="_top"><code class="literal">assertion_requirements_push_back.cpp</code></a>):
        <sup>[<a name="contract__.advanced_topics.assertion_requirements.f1" href="#ftn.contract__.advanced_topics.assertion_requirements.f1" class="footnote">41</a>]</sup>
      </p>
<p>
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">type_traits</span><span class="special">/</span><span class="identifier">has_equal_to</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">vector</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span>
        <span class="identifier">size</span><span class="special">()</span> <span class="special">&lt;=</span> <span class="identifier">capacity</span><span class="special">(),</span>
        <span class="identifier">capacity</span><span class="special">()</span> <span class="special">&lt;=</span> <span class="identifier">max_size</span><span class="special">()</span>
        <span class="comment">// ...</span>
    <span class="special">)</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">push_back</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">value</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">size</span><span class="special">()</span> <span class="special">&lt;</span> <span class="identifier">max_size</span><span class="special">()</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span>
                <span class="keyword">auto</span> <span class="identifier">old_size</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">size</span><span class="special">(),</span>
                <span class="keyword">auto</span> <span class="identifier">old_capacity</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">capacity</span><span class="special">(),</span>
                <span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">old_size</span> <span class="special">+</span> <span class="number">1</span><span class="special">,</span>
                <span class="identifier">capacity</span><span class="special">()</span> <span class="special">&gt;=</span> <span class="identifier">old_capacity</span><span class="special">,</span>
                <span class="comment">// Requirements disable assertion if `T` has no `operator==`.</span>
                <span class="identifier">back</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span><span class="special">,</span> <span class="identifier">requires</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span>
            <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">vector_</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="identifier">value</span><span class="special">);</span>
    <span class="special">}</span>

    <span class="comment">// ...</span>
</pre>
<p>
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">struct</span> <span class="identifier">num</span> <span class="comment">// Not equality comparable.</span>
<span class="special">{</span>
    <span class="keyword">int</span> <span class="identifier">value</span><span class="special">;</span>
    <span class="keyword">explicit</span> <span class="identifier">num</span> <span class="special">(</span> <span class="keyword">int</span> <span class="identifier">a_value</span> <span class="special">)</span> <span class="special">:</span> <span class="identifier">value</span><span class="special">(</span><span class="identifier">a_value</span><span class="special">)</span> <span class="special">{}</span>
<span class="special">};</span>

<span class="keyword">int</span> <span class="identifier">main</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
<span class="special">{</span>
    <span class="identifier">vector</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;</span> <span class="identifier">i</span><span class="special">;</span>
    <span class="identifier">i</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="number">123</span><span class="special">);</span>

    <span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">num</span><span class="special">&gt;</span> <span class="identifier">n</span><span class="special">;</span>
    <span class="identifier">n</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="identifier">num</span><span class="special">(</span><span class="number">123</span><span class="special">));</span>
    <span class="identifier">BOOST_TEST</span><span class="special">(</span><span class="keyword">not</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">num</span><span class="special">&gt;::</span><span class="identifier">value</span><span class="special">);</span>

    <span class="comment">// ...</span>
</pre>
<p>
      </p>
<p>
        The <code class="computeroutput"><span class="identifier">i</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="number">123</span><span class="special">)</span></code> call will
        check the postcondition <code class="computeroutput"><span class="identifier">back</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span></code>
        because <code class="computeroutput"><span class="keyword">int</span></code> is <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>
        and the assertion requirement <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;::</span><span class="identifier">value</span></code> is true. However, the <code class="computeroutput"><span class="identifier">n</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="identifier">num</span><span class="special">(</span><span class="number">123</span><span class="special">))</span></code> call
        will not check, and in fact not even compile, the postconditions <code class="computeroutput"><span class="identifier">back</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span></code>
        because <code class="computeroutput"><span class="identifier">num</span></code> is not <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>
        and the assertion requirement <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">num</span><span class="special">&gt;::</span><span class="identifier">value</span></code>
        is false. <sup>[<a name="contract__.advanced_topics.assertion_requirements.f2" href="#ftn.contract__.advanced_topics.assertion_requirements.f2" class="footnote">42</a>]</sup>
      </p>
<p>
        The <a href="http://www.boost.org/doc/libs/release/libs/type_traits" target="_top">Boost.TypeTraits</a>
        library provides a set of meta-functions that are very useful to program
        assertion requirements. <sup>[<a name="contract__.advanced_topics.assertion_requirements.f3" href="#ftn.contract__.advanced_topics.assertion_requirements.f3" class="footnote">43</a>]</sup> However, C++ does not allow to inspect every trait of a type
        so there might be some assertion requirements that unfortunately cannot be
        programmed within the language.
      </p>
<p>
        Another interesting use of assertion requirements is to model assertion computational
        complexity. In some cases, checking assertions can be as computationally
        expensive as executing the function body or even more. While preconditions,
        postconditions, etc can be disabled in groups at compile-time to improve
        performance (using <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_NO_PRECONDITIONS.html" title="Macro CONTRACT_CONFIG_NO_PRECONDITIONS">CONTRACT_CONFIG_NO_PRECONDITIONS</a></code>,
        <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_NO_POSTCONDITIONS.html" title="Macro CONTRACT_CONFIG_NO_POSTCONDITIONS">CONTRACT_CONFIG_NO_POSTCONDITIONS</a></code>,
        etc), it is also useful to be able to disable only specific assertions that
        are very computationally expensive while keeping all other preconditions,
        postconditions, etc enabled. For example (see also <a href="../../../example/contracts/assertion_complexity_factorial.cpp" target="_top"><code class="literal">assertion_complexity_factorial.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="comment">// Assertion requirements used to model assertion computational complexity.</span>
<span class="preprocessor">#define</span> <span class="identifier">O_1</span>      <span class="number">0</span> <span class="comment">// O(1) constant (default).</span>
<span class="preprocessor">#define</span> <span class="identifier">O_N</span>      <span class="number">1</span> <span class="comment">// O(n) linear.</span>
<span class="preprocessor">#define</span> <span class="identifier">O_NN</span>     <span class="number">2</span> <span class="comment">// O(n * n) quadratic.</span>
<span class="preprocessor">#define</span> <span class="identifier">O_NX</span>     <span class="number">3</span> <span class="comment">// O(n^x) polynomial.</span>
<span class="preprocessor">#define</span> <span class="identifier">O_FACTN</span>  <span class="number">4</span> <span class="comment">// O(n!) factorial.</span>
<span class="preprocessor">#define</span> <span class="identifier">O_EXPN</span>   <span class="number">5</span> <span class="comment">// O(e^n) exponential.</span>
<span class="preprocessor">#define</span> <span class="identifier">O_ALL</span>   <span class="number">10</span>
<span class="preprocessor">#define</span> <span class="identifier">COMPLEXITY_MAX</span> <span class="identifier">O_ALL</span>

<span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">int</span> <span class="special">(</span><span class="identifier">factorial</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">int</span> <span class="identifier">n</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">n</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
            <span class="identifier">result</span> <span class="special">&gt;=</span> <span class="number">1</span><span class="special">,</span>
            <span class="keyword">if</span><span class="special">(</span><span class="identifier">n</span> <span class="special">&lt;</span> <span class="number">2</span><span class="special">)</span> <span class="special">(</span>
                <span class="identifier">result</span> <span class="special">==</span> <span class="number">1</span>
            <span class="special">)</span> <span class="keyword">else</span> <span class="special">(</span>
                <span class="comment">// Assertion compiled and checked only if within complexity.</span>
                <span class="identifier">result</span> <span class="special">==</span> <span class="identifier">n</span> <span class="special">*</span> <span class="identifier">factorial</span><span class="special">(</span><span class="identifier">n</span> <span class="special">-</span> <span class="number">1</span><span class="special">),</span>
                        <span class="identifier">requires</span> <span class="identifier">O_FACTN</span> <span class="special">&lt;=</span> <span class="identifier">COMPLEXITY_MAX</span>
            <span class="special">)</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">if</span><span class="special">(</span><span class="identifier">n</span> <span class="special">&lt;</span> <span class="number">2</span><span class="special">)</span> <span class="keyword">return</span> <span class="number">1</span><span class="special">;</span>
    <span class="keyword">else</span> <span class="keyword">return</span> <span class="identifier">n</span> <span class="special">*</span> <span class="identifier">factorial</span><span class="special">(</span><span class="identifier">n</span> <span class="special">-</span> <span class="number">1</span><span class="special">);</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        In this case the postcondition <code class="computeroutput"><span class="identifier">result</span>
        <span class="special">=</span> <span class="identifier">n</span> <span class="special">*</span> <span class="identifier">factorial</span><span class="special">(</span><span class="identifier">n</span> <span class="special">-</span>
        <span class="number">1</span><span class="special">)</span></code>
        has factorial computation complexity and it is compiled and checked at run-time
        only if the macro <code class="computeroutput"><span class="identifier">COMPLEXITY_MAX</span></code>
        is defined to be <code class="computeroutput"><span class="identifier">O_FACTN</span></code>
        or greater. Similarly, macros like <code class="computeroutput"><span class="identifier">O_SMALLER_BODY</span></code>,
        <code class="computeroutput"><span class="identifier">O_BODY</span></code>, and <code class="computeroutput"><span class="identifier">O_GREATER_BODY</span></code> could have been defined
        to express computational complexity in relative terms with respect to the
        body computational complexity (see the <a class="link" href="examples.html" title="Examples">Examples</a>
        section). <sup>[<a name="contract__.advanced_topics.assertion_requirements.f4" href="#ftn.contract__.advanced_topics.assertion_requirements.f4" class="footnote">44</a>]</sup>
      </p>
<p>
        Assertion requirements can be used with assertions, constant assertions,
        and static assertions but they cannot be used with assertion statements and
        with the if-then-else statements of select assertions (however, if select
        assertions are programmed using the ternary operator <code class="computeroutput"><span class="special">:?</span></code>
        then assertion requirements will disable the entire ternary operator <code class="computeroutput"><span class="special">:?</span></code> expression including its if-condition).
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.old_of_requirements"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.old_of_requirements" title="Old-Of Requirements">Old-Of
      Requirements</a>
</h3></div></div></div>
<p>
        Assertion requirements can be specified also for postconditions that use
        old values. However, old values have the additional requirement that the
        type of the expression passed to the <code class="computeroutput"><a class="link" href="../CONTRACT_OLDOF.html" title="Macro CONTRACT_OLDOF">CONTRACT_OLDOF</a></code>
        macro must be <a class="link" href="advanced_topics.html#contract__.advanced_topics.old_and_result_value_copies" title="Old and Result Value Copies"><code class="literal">ConstantCopyConstructible</code></a>.
        If such a requirement is not met:
      </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
            Either, programmers want the compiler to error because the postconditions
            using the old value cannot be evaluated (in which case programmers will
            not specify assertion requirements and they might explicitly specify
            type requirements using concepts so to get more informative error messages,
            see the <a class="link" href="concepts.html" title="Concepts">Concepts</a> section).
          </li>
<li class="listitem">
            Or, programmers want the old value declaration that uses the <code class="computeroutput"><a class="link" href="../CONTRACT_OLDOF.html" title="Macro CONTRACT_OLDOF">CONTRACT_OLDOF</a></code> macro to have no effect
            (because the old value cannot be copied) and the postconditions using
            such an old value to not be evaluated.
          </li>
</ol></div>
<p>
        Unfortunately, C++ cannot automatically detect if a type has a copy constructor
        therefore a special trait <code class="computeroutput"><a class="link" href="../contract/has_oldof.html" title="Struct template has_oldof">contract::has_oldof</a></code>
        had to be introduced to support this second case. The <code class="computeroutput"><span class="identifier">contract</span><span class="special">::</span><span class="identifier">has_oldof</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span></code>
        trait is a unary boolean meta-function which is <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">mpl</span><span class="special">::</span><span class="identifier">true_</span></code> by default for any type <code class="computeroutput"><span class="identifier">T</span></code> and it must be specialized by programmers
        for types which old values cannot be copied.
      </p>
<p>
        For example, consider the following increment function (see also <a href="../../../example/contracts/has_oldof_inc.cpp" target="_top"><code class="literal">has_oldof_inc.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="special">(</span><span class="identifier">T</span><span class="special">&amp;)</span> <span class="special">(</span><span class="identifier">inc</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span><span class="special">&amp;)</span> <span class="identifier">value</span><span class="special">,</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">offset</span> <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">old_value</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">value</span><span class="special">,</span>      <span class="comment">// Skip if no old-of.</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>                       <span class="comment">// Never skipped.</span>
            <span class="identifier">value</span> <span class="special">==</span> <span class="identifier">old_value</span> <span class="special">+</span> <span class="identifier">offset</span><span class="special">,</span> <span class="identifier">requires</span>
                    <span class="identifier">contract</span><span class="special">::</span><span class="identifier">has_oldof</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span> <span class="keyword">and</span>   <span class="comment">// Requires old-of.</span>
                    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_plus</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span> <span class="keyword">and</span>
                    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span><span class="special">,</span>
            <span class="identifier">result</span> <span class="special">==</span> <span class="identifier">value</span><span class="special">,</span> <span class="identifier">requires</span>
                    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">return</span> <span class="identifier">value</span> <span class="special">+=</span> <span class="identifier">offset</span><span class="special">;</span>
<span class="special">}</span>

<span class="keyword">class</span> <span class="identifier">num</span> <span class="special">:</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">noncopyable</span> <span class="comment">// Non-copyable (for some reason...).</span>
<span class="special">{</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">explicit</span> <span class="identifier">num</span> <span class="special">(</span> <span class="keyword">int</span> <span class="identifier">value</span> <span class="special">)</span> <span class="special">:</span> <span class="identifier">ptr_</span><span class="special">(</span><span class="keyword">new</span> <span class="keyword">int</span><span class="special">(</span><span class="identifier">value</span><span class="special">))</span> <span class="special">{}</span>
    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">num</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">other</span> <span class="special">)</span> <span class="special">:</span> <span class="identifier">ptr_</span><span class="special">(</span><span class="identifier">other</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">)</span> <span class="special">{}</span> <span class="comment">// Private copy.</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="special">~</span><span class="identifier">num</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="special">{</span> <span class="keyword">delete</span> <span class="identifier">ptr_</span><span class="special">;</span> <span class="special">}</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="identifier">num</span> <span class="keyword">operator</span><span class="special">+</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span> <span class="keyword">const</span>
        <span class="special">{</span> <span class="keyword">return</span> <span class="identifier">num</span><span class="special">(*</span><span class="identifier">ptr_</span> <span class="special">+</span> <span class="special">*</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">);</span> <span class="special">}</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="identifier">num</span><span class="special">&amp;</span> <span class="keyword">operator</span><span class="special">+=</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span>
        <span class="special">{</span> <span class="special">*</span><span class="identifier">ptr_</span> <span class="special">+=</span> <span class="special">*</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">;</span> <span class="keyword">return</span> <span class="special">*</span><span class="keyword">this</span><span class="special">;</span> <span class="special">}</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">==</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span> <span class="keyword">const</span>
        <span class="special">{</span> <span class="keyword">return</span> <span class="special">*</span><span class="identifier">ptr_</span> <span class="special">==</span> <span class="special">*</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">;</span> <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="keyword">int</span><span class="special">*</span> <span class="identifier">ptr_</span><span class="special">;</span>
<span class="special">};</span>

<span class="comment">// Specialization disables old-of for non-copyable `num` (no C++ type trait can</span>
<span class="comment">// automatically detect copy constructors).</span>
<span class="keyword">namespace</span> <span class="identifier">contract</span>
<span class="special">{</span>
    <span class="keyword">template</span><span class="special">&lt;</span> <span class="special">&gt;</span> <span class="keyword">struct</span> <span class="identifier">has_oldof</span> <span class="special">&lt;</span> <span class="identifier">num</span> <span class="special">&gt;</span> <span class="special">:</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">mpl</span><span class="special">::</span><span class="identifier">false_</span> <span class="special">{};</span>
<span class="special">}</span> <span class="comment">// namespace</span>
</pre>
<p>
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">i</span> <span class="special">=</span> <span class="number">1</span><span class="special">,</span> <span class="identifier">j</span> <span class="special">=</span> <span class="number">2</span><span class="special">;</span>
<span class="identifier">BOOST_TEST</span><span class="special">(</span><span class="identifier">inc</span><span class="special">(</span><span class="identifier">i</span><span class="special">,</span> <span class="identifier">j</span><span class="special">)</span> <span class="special">==</span> <span class="number">3</span><span class="special">);</span>

<span class="identifier">num</span> <span class="identifier">n</span><span class="special">(</span><span class="number">1</span><span class="special">),</span> <span class="identifier">m</span><span class="special">(</span><span class="number">2</span><span class="special">);</span>
<span class="identifier">BOOST_TEST</span><span class="special">(</span><span class="identifier">inc</span><span class="special">(</span><span class="identifier">n</span><span class="special">,</span> <span class="identifier">m</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">num</span><span class="special">(</span><span class="number">3</span><span class="special">));</span>
</pre>
<p>
      </p>
<p>
        In this example, the <code class="computeroutput"><span class="identifier">num</span></code>
        type is non-copyable so the <code class="computeroutput"><span class="identifier">contract</span><span class="special">::</span><span class="identifier">has_oldof</span><span class="special">&lt;</span><span class="identifier">num</span><span class="special">&gt;</span></code> specialization inherits from <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">mpl</span><span class="special">::</span><span class="identifier">false_</span></code>.
        As a consequence, the call <code class="computeroutput"><span class="identifier">inc</span><span class="special">(</span><span class="identifier">n</span><span class="special">,</span>
        <span class="identifier">m</span><span class="special">)</span></code>
        will automatically skip the old value declaration:
      </p>
<pre class="programlisting"><span class="keyword">auto</span> <span class="identifier">old_value</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">value</span>
</pre>
<p>
        The following postcondition will also be skipped because its assertion requirement
        lists <code class="computeroutput"><span class="identifier">contract</span><span class="special">::</span><span class="identifier">has_oldof</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span></code> (where
        <code class="computeroutput"><span class="identifier">T</span></code> is indeed the type of
        <code class="computeroutput"><span class="identifier">value</span></code> passed to the <code class="computeroutput"><a class="link" href="../CONTRACT_OLDOF.html" title="Macro CONTRACT_OLDOF">CONTRACT_OLDOF</a></code> macro):
      </p>
<pre class="programlisting"><span class="identifier">value</span> <span class="special">==</span> <span class="identifier">old_value</span> <span class="special">+</span> <span class="identifier">offset</span><span class="special">,</span> <span class="identifier">requires</span> <span class="identifier">contract</span><span class="special">::</span><span class="identifier">has_oldof</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span> <span class="special">&amp;&amp;</span> <span class="special">...</span>
</pre>
<p>
        Note how this postcondition actually requires the type <code class="computeroutput"><span class="identifier">T</span></code>
        to have an old value, a plus operator <code class="computeroutput"><span class="special">+</span></code>,
        and an equality operator <code class="computeroutput"><span class="special">==</span></code>
        thus all of these requirements are programmed in the assertion requirements.
      </p>
<p>
        Finally, return value declarations are never skipped so there is no <code class="computeroutput"><span class="identifier">has_result</span></code> trait. <sup>[<a name="contract__.advanced_topics.old_of_requirements.f0" href="#ftn.contract__.advanced_topics.old_of_requirements.f0" class="footnote">45</a>]</sup>
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.old_and_result_value_copies"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.old_and_result_value_copies" title="Old and Result Value Copies">Old
      and Result Value Copies</a>
</h3></div></div></div>
<p>
        This library uses the class template <code class="computeroutput"><a class="link" href="../contract/copy.html" title="Class template copy">contract::copy</a></code>
        to copy old values and the result value for postconditions.
      </p>
<pre class="programlisting"><span class="keyword">namespace</span> <span class="identifier">contract</span>
<span class="special">{</span>
    <span class="keyword">template</span><span class="special">&lt;</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">&gt;</span>
    <span class="keyword">class</span> <span class="identifier">copy</span>
    <span class="special">{</span>
        <span class="keyword">public</span><span class="special">:</span> <span class="identifier">copy</span> <span class="special">(</span> <span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">object</span> <span class="special">)</span> <span class="special">;</span>
        <span class="keyword">public</span><span class="special">:</span> <span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">value</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span> <span class="special">;</span>
    <span class="special">};</span>
<span class="special">}</span> <span class="comment">// namespace</span>
</pre>
<p>
        The default implementation of the <code class="computeroutput"><a class="link" href="../contract/copy.html" title="Class template copy">contract::copy</a></code>
        class template requires that the type of the old value expression passed
        to the <code class="computeroutput"><a class="link" href="../CONTRACT_OLDOF.html" title="Macro CONTRACT_OLDOF">CONTRACT_OLDOF</a></code> macro and
        the result type are <a class="link" href="advanced_topics.html#contract__.advanced_topics.old_and_result_value_copies" title="Old and Result Value Copies"><code class="literal">ConstantCopyConstructible</code></a>
        (i.e., these types provide a copy constructor that copies the object from
        a constant reference, the reference has to be constant so to ensure the constant-correctness
        of the copy operations that are executed within the contracts, see also the
        <a class="link" href="contract_programming_overview.html#contract__.contract_programming_overview.constant_correctness" title="Constant-Correctness">Constant-Correctness</a>
        section):
      </p>
<pre class="programlisting"><span class="comment">// `ConstantCopyConstructible&lt;T&gt;` (which implies `CopyConstructible&lt;T&gt;`):</span>
<span class="identifier">T</span><span class="special">::</span><span class="identifier">T</span> <span class="special">(</span> <span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">source</span> <span class="special">)</span> <span class="special">;</span>  <span class="comment">// OK: constant-correct copy constructor.</span>

<span class="comment">// `CopyConstructible&lt;T&gt;` (but not `ConstantCopyConstructible&lt;T&gt;`):</span>
<span class="identifier">T</span><span class="special">::</span><span class="identifier">T</span> <span class="special">(</span> <span class="identifier">T</span><span class="special">&amp;</span> <span class="identifier">source</span> <span class="special">)</span> <span class="special">;</span>        <span class="comment">// Error, copy constructor is not constant-correct.</span>
</pre>
<p>
        Programmers can specialize the <code class="computeroutput"><a class="link" href="../contract/copy.html" title="Class template copy">contract::copy</a></code>
        class template to allow old value and result value copies even for types
        that are not <a class="link" href="advanced_topics.html#contract__.advanced_topics.old_and_result_value_copies" title="Old and Result Value Copies"><code class="literal">ConstantCopyConstructible</code></a>
        (in this case it is the programmers' responsibility to make sure that the
        copy operations that they define are constant-correct, otherwise the contracts
        will no longer be constant-correct). <sup>[<a name="contract__.advanced_topics.old_and_result_value_copies.f0" href="#ftn.contract__.advanced_topics.old_and_result_value_copies.f0" class="footnote">46</a>]</sup>
      </p>
<p>
        In the following example the old and result value declarations use the specialization
        <code class="computeroutput"><span class="identifier">contract</span><span class="special">::</span><span class="identifier">copy</span><span class="special">&lt;</span><span class="identifier">num</span><span class="special">&gt;</span></code>
        so it is possible to access the old and result value of variables of type
        <code class="computeroutput"><span class="identifier">num</span></code> even if <code class="computeroutput"><span class="identifier">num</span></code> is non-copyable (see also <a href="../../../example/contracts/copy_inc.cpp" target="_top"><code class="literal">copy_inc.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="special">(</span><span class="identifier">T</span><span class="special">&amp;)</span> <span class="special">(</span><span class="identifier">inc</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span><span class="special">&amp;)</span> <span class="identifier">value</span><span class="special">,</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">offset</span> <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">old_value</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">value</span><span class="special">,</span>  <span class="comment">// Use `copy`.</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span> <span class="comment">// Would use `copy` but reference so no copy.</span>
            <span class="identifier">value</span> <span class="special">==</span> <span class="identifier">old_value</span> <span class="special">+</span> <span class="identifier">offset</span><span class="special">,</span> <span class="identifier">requires</span>
                    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_plus</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span> <span class="keyword">and</span>
                    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span><span class="special">,</span>
            <span class="identifier">result</span> <span class="special">==</span> <span class="identifier">value</span><span class="special">,</span> <span class="identifier">requires</span>
                    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">return</span> <span class="identifier">value</span> <span class="special">+=</span> <span class="identifier">offset</span><span class="special">;</span>
<span class="special">}</span>

<span class="keyword">class</span> <span class="identifier">num</span> <span class="special">:</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">noncopyable</span> <span class="comment">// Non-copyable (for some reason...).</span>
<span class="special">{</span>
    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="identifier">contract</span><span class="special">::</span><span class="identifier">copy</span><span class="special">&lt;</span><span class="identifier">num</span><span class="special">&gt;;</span> <span class="comment">// Contract copy is friend.</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">explicit</span> <span class="identifier">num</span> <span class="special">(</span> <span class="keyword">int</span> <span class="identifier">value</span> <span class="special">)</span> <span class="special">:</span> <span class="identifier">ptr_</span><span class="special">(</span><span class="keyword">new</span> <span class="keyword">int</span><span class="special">(</span><span class="identifier">value</span><span class="special">))</span> <span class="special">{}</span>
    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">num</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">other</span> <span class="special">)</span> <span class="special">:</span> <span class="identifier">ptr_</span><span class="special">(</span><span class="identifier">other</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">)</span> <span class="special">{}</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="special">~</span><span class="identifier">num</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="special">{</span> <span class="keyword">delete</span> <span class="identifier">ptr_</span><span class="special">;</span> <span class="special">}</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="identifier">num</span> <span class="keyword">operator</span><span class="special">+</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span> <span class="keyword">const</span>
        <span class="special">{</span> <span class="keyword">return</span> <span class="identifier">num</span><span class="special">(*</span><span class="identifier">ptr_</span> <span class="special">+</span> <span class="special">*</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">);</span> <span class="special">}</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="identifier">num</span><span class="special">&amp;</span> <span class="keyword">operator</span><span class="special">+=</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span>
        <span class="special">{</span> <span class="special">*</span><span class="identifier">ptr_</span> <span class="special">+=</span> <span class="special">*</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">;</span> <span class="keyword">return</span> <span class="special">*</span><span class="keyword">this</span><span class="special">;</span> <span class="special">}</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">==</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span> <span class="keyword">const</span>
        <span class="special">{</span> <span class="keyword">return</span> <span class="special">*</span><span class="identifier">ptr_</span> <span class="special">==</span> <span class="special">*</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">;</span> <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="keyword">int</span><span class="special">*</span> <span class="identifier">ptr_</span><span class="special">;</span>
<span class="special">};</span>

<span class="comment">// Specialization disables old-of for non-copyable `num` (no C++ type trait can</span>
<span class="comment">// automatically detect copy constructors).</span>
<span class="keyword">namespace</span> <span class="identifier">contract</span>
<span class="special">{</span>
    <span class="keyword">template</span><span class="special">&lt;</span> <span class="special">&gt;</span>
    <span class="keyword">class</span> <span class="identifier">copy</span> <span class="special">&lt;</span> <span class="identifier">num</span> <span class="special">&gt;</span>
    <span class="special">{</span>
        <span class="keyword">public</span><span class="special">:</span> <span class="keyword">explicit</span> <span class="identifier">copy</span> <span class="special">(</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">n</span> <span class="special">)</span> <span class="special">:</span> <span class="identifier">num_</span><span class="special">(*</span><span class="identifier">n</span><span class="special">.</span><span class="identifier">ptr_</span><span class="special">)</span> <span class="special">{}</span>
        <span class="keyword">public</span><span class="special">:</span> <span class="identifier">num</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">value</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span> <span class="special">{</span> <span class="keyword">return</span> <span class="identifier">num_</span><span class="special">;</span> <span class="special">}</span>

        <span class="keyword">private</span><span class="special">:</span> <span class="identifier">num</span> <span class="identifier">num_</span><span class="special">;</span>
    <span class="special">};</span>
<span class="special">}</span> <span class="comment">// namespace</span>
</pre>
<p>
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">i</span> <span class="special">=</span> <span class="number">1</span><span class="special">,</span> <span class="identifier">j</span> <span class="special">=</span> <span class="number">2</span><span class="special">;</span>
<span class="identifier">BOOST_TEST</span><span class="special">(</span><span class="identifier">inc</span><span class="special">(</span><span class="identifier">i</span><span class="special">,</span> <span class="identifier">j</span><span class="special">)</span> <span class="special">==</span> <span class="number">3</span><span class="special">);</span>

<span class="identifier">num</span> <span class="identifier">n</span><span class="special">(</span><span class="number">1</span><span class="special">),</span> <span class="identifier">m</span><span class="special">(</span><span class="number">2</span><span class="special">);</span>
<span class="identifier">BOOST_TEST</span><span class="special">(</span><span class="identifier">inc</span><span class="special">(</span><span class="identifier">n</span><span class="special">,</span> <span class="identifier">m</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">num</span><span class="special">(</span><span class="number">3</span><span class="special">));</span>
</pre>
<p>
      </p>
<p>
        Both calls <code class="computeroutput"><span class="identifier">inc</span><span class="special">(</span><span class="identifier">i</span><span class="special">,</span> <span class="identifier">j</span><span class="special">)</span></code> and <code class="computeroutput"><span class="identifier">inc</span><span class="special">(</span><span class="identifier">n</span><span class="special">,</span>
        <span class="identifier">m</span><span class="special">)</span></code>
        check all postconditions. The first call copies the old and result values
        using <code class="computeroutput"><span class="keyword">int</span></code>'s default copy constructor,
        the second call copies the old and result values using the copy operation
        implemented by the <code class="computeroutput"><span class="identifier">contract</span><span class="special">::</span><span class="identifier">copy</span><span class="special">&lt;</span><span class="identifier">num</span><span class="special">&gt;</span></code> specialization.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.pure_virtual_functions"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.pure_virtual_functions" title="Pure Virtual Functions">Pure
      Virtual Functions</a>
</h3></div></div></div>
<p>
        It is possible to program contracts for pure virtual functions. Pure virtual
        functions are specified with the usual <code class="computeroutput"><span class="special">=</span>
        <span class="number">0</span><span class="special">;</span></code>
        symbol replacing the function definition just after the contract macros,
        for example (see also <a href="../../../example/contracts/pushable.hpp" target="_top"><code class="literal">pushable.hpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">pushable</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="comment">// Subcontracting: In `and` with derived class invariants.</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">const_reference</span> <span class="identifier">const_reference</span><span class="special">;</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">push_back</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">value</span> <span class="special">)</span> <span class="keyword">new</span>
            <span class="comment">// Subcontracting: In `or` with overriding function preconditions.</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="keyword">false</span> <span class="special">)</span> <span class="comment">// Force check to overriding preconditions.</span>
            <span class="comment">// Subcontracting: In `and` with overriding function postconditions.</span>
            <span class="identifier">postcondition</span><span class="special">(</span>
                <span class="identifier">back</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span><span class="special">,</span> <span class="identifier">requires</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span>
            <span class="special">)</span>
    <span class="special">)</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span> <span class="comment">// Contract for pure virtual function.</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">virtual</span> <span class="identifier">const_reference</span> <span class="identifier">back</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        Furthermore, using the <code class="computeroutput"><a class="link" href="../CONTRACT_MEMBER_BODY.html" title="Macro CONTRACT_MEMBER_BODY">CONTRACT_MEMBER_BODY</a></code>
        macro, a derived class can be programmed without using the <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS.html" title="Macro CONTRACT_CLASS">CONTRACT_CLASS</a></code>
        and <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code> macros
        even when the base class has pure virtual functions (see also <a href="../../../example/contracts/default_subcontracting_base.cpp" target="_top"><code class="literal">default_subcontracting_base.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">base</span><span class="special">)</span> <span class="comment">// Declared with contract macros.</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">clog</span> <span class="special">&lt;&lt;</span> <span class="string">"base::inv"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span> <span class="special">)</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">f</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">clog</span> <span class="special">&lt;&lt;</span> <span class="string">"base::f::pre"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">clog</span> <span class="special">&lt;&lt;</span> <span class="string">"base::f::post"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">class</span> <span class="identifier">deriv</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">base</span> <span class="comment">// Declared without contract macros...</span>
<span class="special">{</span>
    <span class="comment">// ...but using `BODY` instead of `CLASS` and `FUNCTION` macros, overriding</span>
    <span class="comment">// functions have exact same contracts as base (not real subcontracting).</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="identifier">CONTRACT_MEMBER_BODY</span><span class="special">(</span><span class="identifier">f</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
    <span class="special">{</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">clog</span> <span class="special">&lt;&lt;</span> <span class="string">"deriv::f::body"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        This use of the <code class="computeroutput"><a class="link" href="../CONTRACT_MEMBER_BODY.html" title="Macro CONTRACT_MEMBER_BODY">CONTRACT_MEMBER_BODY</a></code>
        macro does not force programmers of derived classes to use the library macros
        <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS.html" title="Macro CONTRACT_CLASS">CONTRACT_CLASS</a></code> and <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code> which would otherwise
        introduce the unusual library syntax in the derived class declaration. However,
        in this case the derived class is forced to inherit the base class invariants,
        preconditions, and postconditions exactly as they are without the possibility
        to truly subcontract the base class (which is instead possible when the
        <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS.html" title="Macro CONTRACT_CLASS">CONTRACT_CLASS</a></code> and <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code> macros are used in
        declaring the derived class). <sup>[<a name="contract__.advanced_topics.pure_virtual_functions.f0" href="#ftn.contract__.advanced_topics.pure_virtual_functions.f0" class="footnote">47</a>]</sup> Correctly, the derived class can never avoid checking the base
        class contracts neither when declared using the <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS.html" title="Macro CONTRACT_CLASS">CONTRACT_CLASS</a></code>
        and <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code> macros,
        nor when declared using the <code class="computeroutput"><a class="link" href="../CONTRACT_MEMBER_BODY.html" title="Macro CONTRACT_MEMBER_BODY">CONTRACT_MEMBER_BODY</a></code>
        macro.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.subcontracting_preconditions"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.subcontracting_preconditions" title="Subcontracting Preconditions">Subcontracting
      Preconditions</a>
</h3></div></div></div>
<p>
        While subcontracting is theoretically sound and justified by the <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_top">substitution
        principle</a>, in practise subcontracted preconditions might be confusing
        for programmers because of the implications of evaluating overriding preconditions
        in <a class="link" href="contract_programming_overview.html#logic_or_anchor">logic-or</a> with overridden preconditions
        (this is not the case for subcontracted postconditions and class invariants
        which usually behave as programmers expect because they are evaluated in
        <a class="link" href="contract_programming_overview.html#logic_and_anchor">logic-and</a>).
      </p>
<p>
        For example, consider the following base class <code class="computeroutput"><span class="identifier">integer</span></code>
        which holds an integral value and its derived class <code class="computeroutput"><span class="identifier">natural</span></code>
        which holds a natural (i.e., non-negative integer) value (see also <a href="../../../example/contracts/subcontract_pre_natural_failure.cpp" target="_top"><code class="literal">subcontract_pre_natural_failure.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">integer</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">set</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">int</span> <span class="identifier">value</span> <span class="special">)</span>
            <span class="comment">// No preconditions so this and all overrides can always be called.</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="identifier">get</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">value_</span> <span class="special">=</span> <span class="identifier">value</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">int</span> <span class="special">(</span><span class="identifier">get</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">value_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="keyword">int</span> <span class="identifier">value_</span><span class="special">;</span>
<span class="special">};</span>

<span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">natural</span><span class="special">)</span> <span class="identifier">extends</span><span class="special">(</span> <span class="keyword">public</span> <span class="identifier">integer</span> <span class="special">)</span> <span class="comment">// Subcontract.</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="identifier">get</span><span class="special">()</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">set</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">int</span> <span class="identifier">value</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">value</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span> <span class="comment">// NOTE: Will not fail because of base.</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">integer</span><span class="special">::</span><span class="identifier">CONTRACT_MEMBER_BODY</span><span class="special">(</span><span class="identifier">set</span><span class="special">)(</span><span class="identifier">value</span><span class="special">);</span>
    <span class="special">}</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        From reading the contracts we conclude that:
      </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
            <code class="computeroutput"><span class="identifier">integer</span><span class="special">::</span><span class="identifier">get</span></code> returns the latest value set (as
            specified by <code class="computeroutput"><span class="identifier">integer</span><span class="special">::</span><span class="identifier">set</span></code>
            postconditions).
          </li>
<li class="listitem">
            There is no constraint on the integer value that is passed to <code class="computeroutput"><span class="identifier">integer</span><span class="special">::</span><span class="identifier">set</span></code> (because <code class="computeroutput"><span class="identifier">integer</span><span class="special">::</span><span class="identifier">set</span></code>
            has no precondition).
          </li>
<li class="listitem">
            <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">get</span></code> always returns a non-negative value
            (as specified by the <code class="computeroutput"><span class="identifier">natural</span></code>
            class invariants).
          </li>
<li class="listitem">
            Only non-negative values can be passed to <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code>
            (as specified by <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code>
            preconditions).
          </li>
</ul></div>
<p>
        This last conclusion is incorrect! Negative values can be passed to <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> because they can be passed to its base
        virtual function <code class="computeroutput"><span class="identifier">integral</span><span class="special">::</span><span class="identifier">set</span></code> (preconditions
        cannot only be weakened). The complete set of <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> preconditions
        is given by its base virtual function <code class="computeroutput"><span class="identifier">integer</span><span class="special">::</span><span class="identifier">set</span></code> preconditions
        (which are always <code class="computeroutput"><span class="keyword">true</span></code> because
        they are not specified) evaluated in <a class="link" href="contract_programming_overview.html#logic_or_anchor">logic-or</a>
        with the preconditions explicitly specified by <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> (i.e.,
        <code class="computeroutput"><span class="identifier">value</span> <span class="special">&gt;=</span>
        <span class="number">0</span></code>):
      </p>
<pre class="programlisting"><span class="special">(</span><span class="keyword">true</span><span class="special">)</span> <span class="keyword">or</span> <span class="special">(</span><span class="identifier">value</span> <span class="special">&gt;=</span> <span class="number">0</span><span class="special">)</span>
</pre>
<p>
        Obviously, this always evaluates to <code class="computeroutput"><span class="keyword">true</span></code>
        regardless of <code class="computeroutput"><span class="identifier">value</span></code> being
        non-negative. This is correct in accordance with the <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_top">substitution
        principle</a> for which <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> can
        be called in any context where <code class="computeroutput"><span class="identifier">integer</span><span class="special">::</span><span class="identifier">set</span></code> is
        called because <code class="computeroutput"><span class="identifier">natural</span></code> inherits
        from <code class="computeroutput"><span class="identifier">integer</span></code>. Given that
        <code class="computeroutput"><span class="identifier">integer</span><span class="special">::</span><span class="identifier">set</span></code> can be called regardless of <code class="computeroutput"><span class="identifier">value</span></code> being non-negative (because it has
        no precondition) there is no precondition that we can later specify for
        <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> that will change that and in fact
        <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> can also be called with negative values
        without failing its subcontracted preconditions. For example, the call:
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">natural</span> <span class="identifier">n</span><span class="special">;</span>
<span class="identifier">n</span><span class="special">.</span><span class="identifier">set</span><span class="special">(-</span><span class="number">123</span><span class="special">);</span> <span class="comment">// Error: Fails call invariants instead of preconditions.</span>
</pre>
<p>
      </p>
<p>
        Fails the class invariants checked while exiting <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code>:
      </p>
<pre class="programlisting">class invariant (on exit) number 1 "get() &gt;= 0" failed: file "natural_subcontractpre.cpp", line 30
</pre>
<p>
        Ideally, this call would have failed much earlier at <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> preconditions
        (in fact, the <code class="computeroutput"><span class="identifier">natural</span><span class="special">::</span><span class="identifier">set</span></code> body is executed with the logically
        invalid negative value <code class="computeroutput"><span class="special">-</span><span class="number">123</span></code>
        which could in general lead to catastrophic errors and mysterious bugs).
      </p>
<p>
        The issue here is in the design. A natural number is not an integer number
        because while it is valid to use an integer number in a context where it
        is assigned to a negative number, it is not valid to use a natural number
        in such a context so a natural number should not inherit from an integer
        number. Inheritance models the <a href="http://en.wikipedia.org/wiki/Is-a" target="_top"><span class="emphasis"><em>is-a</em></span></a>
        relationship which should not be used in this case as the contracts and the
        <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_top">substitution
        principle</a> are telling us.
      </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          Note that if a virtual member function has no preconditions, it means that
          it is always valid to call it, and (in accordance with the <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_top">substitution
          principle</a>) this semantic cannot be changed by the contracts of
          any overriding function no matter what preconditions we specify for it.
          Similarly, if an overriding member function has no preconditions, it means
          that is is always valid to call it regardless of possible preconditions
          specified by any function that it overrides.
        </p></td></tr>
</table></div>
<p>
        An overriding function can specify <code class="computeroutput"><span class="identifier">precondition</span><span class="special">(</span> <span class="keyword">false</span> <span class="special">)</span></code>
        if it wants to keep the same preconditions of the functions that is overriding.
        A pure virtual function can specify <code class="computeroutput"><span class="identifier">precondition</span><span class="special">(</span> <span class="keyword">false</span> <span class="special">)</span></code>
        to indicate that overriding functions will specify preconditions (this only
        makes sense for pure virtual functions because a function with <code class="computeroutput"><span class="identifier">precondition</span><span class="special">(</span>
        <span class="keyword">false</span> <span class="special">)</span></code>
        can never be called successfully unless it is overridden and its preconditions
        are weakened, that might be acceptable for pure virtual because they must
        always be overridden).
      </p>
<p>
        If programmers find subcontracted preconditions confusing, this library allows
        to forbid them by defining the configuration macro <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS.html" title="Macro CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS">CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS</a></code>.
        When this macro if defined, the library will generate a compile-time error
        if a derived class tries to override preconditions of member functions of
        any of its base classes (this is also the subcontracting behaviour specified
        by <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>). However, note that in case
        of multiple-inheritance preconditions from the overridden function from all
        bases classes will always be checked in <a class="link" href="contract_programming_overview.html#logic_or_anchor">logic-or</a>
        with each other so preconditions from a base class could still be weaken
        by the preconditions of another base class even when the <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS.html" title="Macro CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS">CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS</a></code>
        macro is defined. By default the <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS.html" title="Macro CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS">CONTRACT_CONFIG_DO_NOT_SUBCONTRACT_PRECONDITIONS</a></code>
        macro is not defined and this library allows to override preconditions (as
        specified by for <a href="http://en.wikipedia.org/wiki/Eiffel_(programming_language)" target="_top">Eiffel</a>
        by <a class="link" href="bibliography.html#Meyer97_anchor">[Meyer97]</a> and in accordance with
        the <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_top">substitution
        principle</a>).
      </p>
<p>
        Another difference between subcontracted preconditions and subcontracted
        postconditions or class invariants is that subcontracted preconditions will
        always report a failure of the overridden preconditions. For example, consider
        a set of base classes <code class="literal">b<span class="emphasis"><em>N</em></span></code> and a derived
        class <code class="computeroutput"><span class="identifier">d</span></code>:
      </p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">struct</span> <span class="special">(</span><span class="identifier">a</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="special">...</span> <span class="comment">// No member function `f`.</span>
<span class="special">};</span>

<span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">struct</span> <span class="special">(</span><span class="identifier">b</span><span class="emphasis"><em>N</em></span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="special">...</span> <span class="special">)</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">f</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="comment">// Overridden function.</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="special">...</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="special">...</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="special">...</span>
<span class="special">};</span>

<span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">struct</span> <span class="special">(</span><span class="identifier">c</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="special">...</span> <span class="comment">// No member function `f`.</span>
<span class="special">};</span>

<span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">struct</span> <span class="special">(</span><span class="identifier">d</span><span class="special">)</span> <span class="identifier">extends</span><span class="special">(</span> <span class="identifier">b1</span><span class="special">,</span> <span class="identifier">a</span><span class="special">,</span> <span class="identifier">b2</span><span class="special">,</span> <span class="identifier">c</span><span class="special">,</span> <span class="identifier">b3</span> <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="special">...</span> <span class="special">)</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">f</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="comment">// Overriding function.</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="special">...</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="special">...</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="special">...</span>
<span class="special">};</span>
</pre>
<p>
        When <code class="computeroutput"><span class="identifier">d</span><span class="special">::</span><span class="identifier">f</span></code> is called, its subcontracted class invariants,
        postconditions, and preconditions are evaluated using the following expressions
        (the base classes <code class="computeroutput"><span class="identifier">a</span></code> and
        <code class="computeroutput"><span class="identifier">c</span></code> do not declare a virtual
        function <code class="computeroutput"><span class="identifier">f</span></code> so they are automatically
        excluded from <code class="computeroutput"><span class="identifier">d</span><span class="special">::</span><span class="identifier">f</span></code> subcontracting):
      </p>
<pre class="programlisting"><span class="identifier">b1</span><span class="special">::</span><span class="emphasis"><em>class-invariants</em></span>  <span class="keyword">and</span> <span class="identifier">b2</span><span class="special">::</span><span class="emphasis"><em>class-invariants</em></span>  <span class="keyword">and</span> <span class="identifier">b3</span><span class="special">::</span><span class="emphasis"><em>class-invariants</em></span>  <span class="keyword">and</span> <span class="identifier">d</span><span class="special">::</span><span class="emphasis"><em>class-invariants</em></span>  <span class="comment">// `d::f` subcontracted class invariants.</span>
<span class="identifier">b1</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>postconditions</em></span> <span class="keyword">and</span> <span class="identifier">b2</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>postconditions</em></span> <span class="keyword">and</span> <span class="identifier">b3</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>postconditions</em></span> <span class="keyword">and</span> <span class="identifier">d</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>postconditions</em></span> <span class="comment">// `d::f` subcontracted postconditions.</span>
<span class="identifier">b1</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>preconditions</em></span>  <span class="keyword">or</span>  <span class="identifier">b2</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>preconditions</em></span>  <span class="keyword">or</span>  <span class="identifier">b3</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>preconditions</em></span>  <span class="keyword">or</span>  <span class="identifier">d</span><span class="special">::</span><span class="identifier">f</span><span class="special">::</span><span class="emphasis"><em>preconditions</em></span>  <span class="comment">// `d::f` subcontracted preconditions.</span>
</pre>
<p>
        When subcontracted class invariants or subcontracted postconditions fail,
        this library reports the first failed condition which can in general be in
        the base class contracts because they are checked first in the <a class="link" href="contract_programming_overview.html#logic_and_anchor">logic-and</a>
        chain (this can report a failure from any subcontracted class invariants
        <code class="literal">b<span class="emphasis"><em>N</em></span>::<span class="emphasis"><em>class-invariants</em></span></code>
        or <code class="literal">d::<span class="emphasis"><em>class-invariants</em></span></code>, and subcontracted
        postconditions <code class="literal">b<span class="emphasis"><em>N</em></span>::f::<span class="emphasis"><em>postconditions</em></span></code>
        or <code class="literal">d::f::<span class="emphasis"><em>postconditions</em></span></code>). However,
        when subcontracted preconditions fail it means that all overridden preconditions
        as well as the overriding preconditions have failed (because subcontracted
        preconditions are evaluated in <a class="link" href="contract_programming_overview.html#logic_or_anchor">logic-or</a>).
        In this case, this library will report the last evaluated failure which will
        always be in the overriding preconditions (always report a failure from
        <code class="literal">d::f::<span class="emphasis"><em>preconditions</em></span></code>). If programmers
        want instead the library to report the failure from the first overridden
        precondition that failed, they can define the configuration macro <code class="computeroutput"><a class="link" href="../CONTRACT_CONFIG_REPORT_BASE_PRECONDITION_FAILURE.html" title="Macro CONTRACT_CONFIG_REPORT_BASE_PRECONDITION_FAILURE">CONTRACT_CONFIG_REPORT_BASE_PRECONDITION_FAILURE</a></code>
        (always report a failure from <code class="literal">b1::f::<span class="emphasis"><em>preconditions</em></span></code>).
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.static_member_functions"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.static_member_functions" title="Static Member Functions">Static
      Member Functions</a>
</h3></div></div></div>
<p>
        It is possible to program contracts for static member functions. Static member
        functions cannot access the object therefore their preconditions and postconditions
        also cannot access the object and they can only access other static members.
        This library allows to specify a subset of class invariants called <span class="emphasis"><em>static
        class invariants</em></span> which do not access the object and that are checked
        at entry and exit of every constructor, destructor, and member functions
        even if static. (Non-static class invariants are instead not checked at constructor
        entry, at destructor exit, and at entry and exit of static member functions
        because they require accessing the object, see also the <a class="link" href="contract_programming_overview.html" title="Contract Programming Overview">Contract
        Programming Overview</a> section.)
      </p>
<p>
        Static class invariants are empty (<code class="computeroutput"><span class="keyword">void</span></code>)
        by default unless they are explicitly specified within the <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS_INVARIANT.html" title="Macro CONTRACT_CLASS_INVARIANT">CONTRACT_CLASS_INVARIANT</a></code>
        macro using the following syntax: <sup>[<a name="contract__.advanced_topics.static_member_functions.f0" href="#ftn.contract__.advanced_topics.static_member_functions.f0" class="footnote">48</a>]</sup>
      </p>
<pre class="programlisting"><span class="keyword">static</span> <span class="keyword">class</span><span class="special">(</span> <span class="emphasis"><em>assertion1</em></span><span class="special">,</span> <span class="emphasis"><em>assertion2</em></span><span class="special">,</span> <span class="special">...</span> <span class="special">)</span>
</pre>
<p>
        For example (see also <a href="../../../example/contracts/static_contract_instance_counter.cpp" target="_top"><code class="literal">static_contract_instance_counter.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">instance_counter</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span>
        <span class="identifier">object</span><span class="special">(),</span> <span class="comment">// Non-static class invariants.</span>
        <span class="keyword">static</span> <span class="keyword">class</span><span class="special">(</span> <span class="comment">// Static class invariants.</span>
            <span class="identifier">count</span><span class="special">()</span> <span class="special">&gt;=</span> <span class="number">0</span>
            <span class="comment">// ...</span>
        <span class="special">)</span>
    <span class="special">)</span>

    <span class="identifier">CONTRACT_CONSTRUCTOR_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">explicit</span> <span class="special">(</span><span class="identifier">instance_counter</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span><span class="special">*)</span> <span class="identifier">the_object</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">the_object</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span>
                <span class="keyword">auto</span> <span class="identifier">old_count</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">count</span><span class="special">(),</span>
                <span class="identifier">count</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">old_count</span> <span class="special">+</span> <span class="number">1</span><span class="special">,</span>
                <span class="identifier">object</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">the_object</span>
            <span class="special">)</span>
            <span class="identifier">initialize</span><span class="special">(</span> <span class="identifier">object_</span><span class="special">(</span><span class="identifier">the_object</span><span class="special">)</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">count_</span><span class="special">++;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_DESTRUCTOR_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="special">(~</span><span class="identifier">instance_counter</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
            <span class="comment">// FUTURE: Destructors could have static postconditions.</span>
            <span class="comment">// postcondition: count() = oldof count() - 1</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">delete</span> <span class="identifier">object_</span><span class="special">;</span>
        <span class="identifier">count_</span><span class="special">--;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">*</span> <span class="keyword">const</span><span class="special">)</span> <span class="special">(</span><span class="identifier">object</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">object_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span> <span class="comment">// Contract static member function.</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="special">(</span><span class="identifier">count</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
            <span class="comment">// No preconditions nor postconditions for this example but when</span>
            <span class="comment">// present no object can be accessed by assertions (i.e., `static`).</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">count_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="identifier">count_</span><span class="special">;</span>
    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">T</span><span class="special">*</span> <span class="identifier">object_</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">template</span><span class="special">&lt;</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">&gt;</span>
<span class="keyword">int</span> <span class="identifier">instance_counter</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">count_</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
</pre>
<p>
      </p>
<p>
        In this example there is only one static class invariant assertion <code class="computeroutput"><span class="identifier">count</span><span class="special">()</span> <span class="special">&gt;=</span> <span class="number">0</span></code> and
        it is checked at entry and exit of every constructor, destructor, and member
        function including the static member function <code class="computeroutput"><span class="identifier">count</span></code>.
        If the static member function <code class="computeroutput"><span class="identifier">count</span></code>
        had preconditions or postconditions, they would not be able to access the
        object (i.e., preconditions and postconditions will also be executed in static
        context).
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.volatile_member_functions"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.volatile_member_functions" title="Volatile Member Functions">Volatile
      Member Functions</a>
</h3></div></div></div>
<p>
        It is possible to program contracts for volatile member functions. Volatile
        member functions access the object as volatile therefore their preconditions
        and postconditions also access the object as volatile and can only access
        other volatile members. This library allows to specify a different set of
        class invariants called <span class="emphasis"><em>volatile class invariants</em></span> which
        can only access the object as volatile and that are checked at entry and
        exit of every volatile member function. (Constructors and destructors never
        access the object as volatile so volatile class invariants are not checked
        by constructors and destructors, see also the <a class="link" href="contract_programming_overview.html" title="Contract Programming Overview">Contract
        Programming Overview</a> section.)
      </p>
<p>
        Volatile class invariants are assumed to be the same as non-volatile class
        invariants unless they are explicitly specified within the <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS_INVARIANT.html" title="Macro CONTRACT_CLASS_INVARIANT">CONTRACT_CLASS_INVARIANT</a></code>
        macro using the following syntax: <sup>[<a name="contract__.advanced_topics.volatile_member_functions.f0" href="#ftn.contract__.advanced_topics.volatile_member_functions.f0" class="footnote">49</a>]</sup>
      </p>
<pre class="programlisting"><span class="keyword">volatile</span> <span class="keyword">class</span><span class="special">(</span> <span class="emphasis"><em>assertion1</em></span><span class="special">,</span> <span class="emphasis"><em>assertion2</em></span><span class="special">,</span> <span class="special">...</span> <span class="special">)</span>
</pre>
<p>
        In most cases, it will be necessary to explicitly specify volatile class
        invariants when using volatile member functions (unless volatile overloads
        are provided for every member function that is used by the non-volatile class
        invariants).
      </p>
<p>
        For example (see also <a href="../../../example/contracts/volatile_contract_shared_instance.cpp" target="_top"><code class="literal">volatile_contract_shared_instance.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">shared_instance</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span>
        <span class="identifier">queries</span><span class="special">()</span> <span class="special">&gt;=</span> <span class="number">0</span><span class="special">,</span> <span class="comment">// Non-volatile class invariants.</span>
        <span class="keyword">volatile</span> <span class="keyword">class</span><span class="special">(</span> <span class="comment">// Volatile class invariants.</span>
            <span class="identifier">object</span><span class="special">()</span>
            <span class="comment">// ...</span>
        <span class="special">)</span>
    <span class="special">)</span>

    <span class="identifier">CONTRACT_CONSTRUCTOR_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">explicit</span> <span class="special">(</span><span class="identifier">shared_instance</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span><span class="special">*)</span> <span class="identifier">the_object</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">the_object</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="identifier">object</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">the_object</span> <span class="special">)</span>
            <span class="identifier">initialize</span><span class="special">(</span> <span class="identifier">object_</span><span class="special">(</span><span class="identifier">the_object</span><span class="special">),</span> <span class="identifier">queries_</span><span class="special">(</span><span class="number">0</span><span class="special">)</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="identifier">CONTRACT_DESTRUCTOR_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="special">(~</span><span class="identifier">shared_instance</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">delete</span> <span class="identifier">object_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span> <span class="comment">// Contracts for volatile member function.</span>
        <span class="keyword">public</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span> <span class="keyword">volatile</span><span class="special">*</span> <span class="keyword">const</span><span class="special">)</span> <span class="special">(</span><span class="identifier">object</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span> <span class="keyword">volatile</span>
            <span class="comment">// No preconditions nor postconditions for this example but when</span>
            <span class="comment">// present object is `const volatile` within assertions.</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">queries_</span><span class="special">++;</span>
        <span class="keyword">return</span> <span class="identifier">object_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">int</span> <span class="special">(</span><span class="identifier">queries</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">queries_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">T</span> <span class="keyword">volatile</span><span class="special">*</span> <span class="identifier">object_</span><span class="special">;</span>
    <span class="keyword">private</span><span class="special">:</span> <span class="keyword">mutable</span> <span class="keyword">int</span> <span class="identifier">queries_</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        As usual, contracts are checked in constant-correct context therefore only
        <code class="computeroutput"><span class="keyword">const</span> <span class="keyword">volatile</span></code>
        members can be accessed from volatile class invariants, preconditions, and
        postconditions.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.operators"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.operators" title="Operators">Operators</a>
</h3></div></div></div>
<p>
        It is possible to program contracts for operators (both member function operators
        and free function operators). The operator name must be specified using the
        following syntax when passed to the <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code>,
        <code class="computeroutput"><a class="link" href="../CONTRACT_FREE_BODY.html" title="Macro CONTRACT_FREE_BODY">CONTRACT_FREE_BODY</a></code>, and
        <code class="computeroutput"><a class="link" href="../CONTRACT_MEMBER_BODY.html" title="Macro CONTRACT_MEMBER_BODY">CONTRACT_MEMBER_BODY</a></code> macros:
      </p>
<pre class="programlisting"><span class="keyword">operator</span><span class="special">(</span><span class="emphasis"><em>symbol</em></span><span class="special">)(</span><span class="emphasis"><em>arbitrary-alphanumeric-name</em></span><span class="special">)</span>
</pre>
<p>
        The first parameter is the usual operator symbol (<code class="computeroutput"><span class="special">==</span></code>,
        <code class="computeroutput"><span class="special">+</span></code>, etc) the second parameter
        is an arbitrary but alphanumeric name (<code class="computeroutput"><span class="identifier">equal</span></code>,
        <code class="computeroutput"><span class="identifier">plus</span></code>, etc). The operator
        <code class="computeroutput"><span class="keyword">new</span></code>, the operator <code class="computeroutput"><span class="keyword">delete</span></code>, and implicit type conversion operators
        for fundamental types containing no symbol can also be specified simply as:
      </p>
<pre class="programlisting"><span class="keyword">operator</span> <span class="keyword">new</span>
<span class="keyword">operator</span> <span class="keyword">delete</span>
<span class="keyword">operator</span> <span class="emphasis"><em>fundamental-type-without-symbols</em></span>
</pre>
<p>
        The comma operator must be specified as: <sup>[<a name="contract__.advanced_topics.operators.f0" href="#ftn.contract__.advanced_topics.operators.f0" class="footnote">50</a>]</sup>
      </p>
<pre class="programlisting"><span class="keyword">operator</span> <span class="identifier">comma</span>
</pre>
<p>
        For example (see also <a href="../../../example/contracts/member_operator_string.cpp" target="_top"><code class="literal">member_operator_string.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">string</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span>
        <span class="keyword">static</span> <span class="keyword">class</span><span class="special">(</span> <span class="identifier">pointers</span> <span class="special">&gt;=</span> <span class="number">0</span><span class="special">,</span> <span class="identifier">arrays</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
    <span class="special">)</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="identifier">pointers</span><span class="special">;</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="identifier">arrays</span><span class="special">;</span>

    <span class="identifier">CONTRACT_CONSTRUCTOR</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">explicit</span> <span class="special">(</span><span class="identifier">string</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="keyword">char</span> <span class="keyword">const</span><span class="special">*)</span> <span class="identifier">c_str</span><span class="special">,</span> <span class="keyword">default</span><span class="special">(</span><span class="string">""</span><span class="special">)</span> <span class="special">)</span>
            <span class="identifier">initialize</span><span class="special">(</span> <span class="identifier">string_</span><span class="special">(</span><span class="identifier">c_str</span><span class="special">)</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="identifier">CONTRACT_DESTRUCTOR</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="special">(~</span><span class="identifier">string</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span> <span class="comment">// Symbolic operators: `(==)(equal)`, `(())(call)`, etc.</span>
        <span class="keyword">public</span> <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">(==)(</span><span class="identifier">equal</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">string</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">right</span> <span class="special">)</span> <span class="keyword">const</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">string_</span> <span class="special">==</span> <span class="identifier">right</span><span class="special">.</span><span class="identifier">string_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span> <span class="comment">// Implicit type conversion operator (keyword type).</span>
        <span class="keyword">public</span> <span class="keyword">operator</span> <span class="keyword">char</span> <span class="keyword">const</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">string_</span><span class="special">[</span><span class="number">0</span><span class="special">];</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span> <span class="comment">// Implicit type conversion operator (symbolic type).</span>
        <span class="keyword">public</span> <span class="keyword">operator</span><span class="special">(</span><span class="keyword">char</span> <span class="keyword">const</span><span class="special">*)(</span><span class="identifier">char_const_ptr</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">string_</span><span class="special">.</span><span class="identifier">c_str</span><span class="special">();</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span> <span class="comment">// Implicit type conversion operator (type with commas).</span>
        <span class="keyword">public</span> <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">Allocator</span> <span class="special">)</span>
        <span class="keyword">operator</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;)(</span><span class="identifier">std_vector</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;</span> <span class="identifier">v</span><span class="special">(</span><span class="identifier">string_</span><span class="special">.</span><span class="identifier">size</span><span class="special">());</span>
        <span class="keyword">for</span><span class="special">(</span><span class="identifier">size_t</span> <span class="identifier">i</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span> <span class="identifier">i</span> <span class="special">&lt;</span> <span class="identifier">string_</span><span class="special">.</span><span class="identifier">size</span><span class="special">();</span> <span class="special">++</span><span class="identifier">i</span><span class="special">)</span> <span class="identifier">v</span><span class="special">[</span><span class="identifier">i</span><span class="special">]</span> <span class="special">=</span> <span class="identifier">string_</span><span class="special">[</span><span class="identifier">i</span><span class="special">];</span>
        <span class="keyword">return</span> <span class="identifier">v</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span> <span class="comment">// Comma operator (use `comma` to diff. from above).</span>
        <span class="keyword">public</span> <span class="special">(</span><span class="identifier">string</span><span class="special">&amp;)</span> <span class="keyword">operator</span> <span class="identifier">comma</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">string</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">right</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">string_</span> <span class="special">+=</span> <span class="identifier">right</span><span class="special">.</span><span class="identifier">string_</span><span class="special">;</span>
        <span class="keyword">return</span> <span class="special">*</span><span class="keyword">this</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="comment">// All memory operators (new, delete, new[], and delete[]) must be</span>
    <span class="comment">// explicitly `static` (because pp can't inspect new[] and delete[] that</span>
    <span class="comment">// could be any symbolic operator like ==, +, etc).</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="special">(</span><span class="keyword">void</span><span class="special">*)</span> <span class="keyword">operator</span> <span class="keyword">new</span> <span class="special">(</span> <span class="identifier">size_t</span> <span class="identifier">size</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">void</span><span class="special">*</span> <span class="identifier">p</span> <span class="special">=</span> <span class="identifier">malloc</span><span class="special">(</span><span class="identifier">size</span><span class="special">);</span>
        <span class="keyword">if</span><span class="special">(</span><span class="identifier">p</span> <span class="special">==</span> <span class="number">0</span><span class="special">)</span> <span class="keyword">throw</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">bad_alloc</span><span class="special">();</span>
        <span class="identifier">pointers</span><span class="special">++;</span>
        <span class="keyword">return</span> <span class="identifier">p</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span> <span class="special">(</span> <span class="special">(</span><span class="keyword">void</span><span class="special">*)</span> <span class="identifier">pointer</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">if</span><span class="special">(</span><span class="identifier">pointer</span><span class="special">)</span> <span class="special">{</span>
            <span class="identifier">free</span><span class="special">(</span><span class="identifier">pointer</span><span class="special">);</span>
            <span class="identifier">pointers</span><span class="special">--;</span>
        <span class="special">}</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="special">(</span><span class="keyword">void</span><span class="special">*)</span> <span class="keyword">operator</span><span class="special">(</span><span class="keyword">new</span><span class="special">[])(</span><span class="identifier">new_array</span><span class="special">)</span> <span class="special">(</span> <span class="identifier">size_t</span> <span class="identifier">size</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">void</span><span class="special">*</span> <span class="identifier">a</span> <span class="special">=</span> <span class="identifier">malloc</span><span class="special">(</span><span class="identifier">size</span><span class="special">);</span>
        <span class="keyword">if</span><span class="special">(</span><span class="identifier">a</span> <span class="special">==</span> <span class="number">0</span><span class="special">)</span> <span class="keyword">throw</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">bad_alloc</span><span class="special">();</span>
        <span class="identifier">arrays</span><span class="special">++;</span>
        <span class="keyword">return</span> <span class="identifier">a</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="keyword">operator</span><span class="special">(</span><span class="keyword">delete</span><span class="special">[])(</span><span class="identifier">delete_array</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="keyword">void</span><span class="special">*)</span> <span class="identifier">array</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">if</span><span class="special">(</span><span class="identifier">array</span><span class="special">)</span> <span class="special">{</span>
            <span class="identifier">free</span><span class="special">(</span><span class="identifier">array</span><span class="special">);</span>
            <span class="identifier">arrays</span><span class="special">--;</span>
        <span class="special">}</span>
    <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">string_</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">int</span> <span class="identifier">string</span><span class="special">::</span><span class="identifier">pointers</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
<span class="keyword">int</span> <span class="identifier">string</span><span class="special">::</span><span class="identifier">arrays</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
</pre>
<p>
      </p>
<p>
        The memory operators <code class="computeroutput"><span class="keyword">new</span></code>, <code class="computeroutput"><span class="keyword">delete</span></code>, <code class="computeroutput"><span class="keyword">new</span><span class="special">[]</span></code>, and <code class="computeroutput"><span class="keyword">delete</span><span class="special">[]</span></code> must always be specified <code class="computeroutput"><span class="keyword">static</span></code> when they are programmed as member
        function operators. <sup>[<a name="contract__.advanced_topics.operators.f1" href="#ftn.contract__.advanced_topics.operators.f1" class="footnote">51</a>]</sup>
      </p>
<p>
        Free function operators are programmed using the same syntax for the operator
        names.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.nested_classes"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.nested_classes" title="Nested Classes">Nested Classes</a>
</h3></div></div></div>
<p>
        It is possible to program contracts for nested classes noting that:
      </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
            The access level <code class="computeroutput"><span class="keyword">public</span></code>,
            <code class="computeroutput"><span class="keyword">protected</span></code>, or <code class="computeroutput"><span class="keyword">private</span></code> must be specified for contracted
            members and therefore also for nested classes.
          </li>
<li class="listitem">
            The <code class="computeroutput"><span class="identifier">_TPL</span></code> macros must
            be used within templates so the <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS_TPL.html" title="Macro CONTRACT_CLASS_TPL">CONTRACT_CLASS_TPL</a></code>
            macro needs to be used when programming a class nested within a class
            template.
          </li>
</ol></div>
<p>
        For example (see also <a href="../../../example/contracts/nested_class_bitset.cpp" target="_top"><code class="literal">nested_class_bitset.cpp</code></a> and
        the <a class="link" href="concepts.html" title="Concepts">Concepts</a> section):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span> <span class="comment">// Enclosing class.</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="identifier">size_t</span> <span class="identifier">N</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">bitset</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span>
        <span class="keyword">static</span> <span class="keyword">class</span><span class="special">(</span> <span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">N</span> <span class="special">)</span>
    <span class="special">)</span>

    <span class="identifier">CONTRACT_CLASS_TPL</span><span class="special">(</span> <span class="comment">// Nested class.</span>
        <span class="keyword">public</span> <span class="keyword">class</span> <span class="special">(</span><span class="identifier">reference</span><span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span> <span class="identifier">bitptr_</span> <span class="special">)</span>

        <span class="keyword">friend</span> <span class="keyword">class</span> <span class="identifier">bitset</span><span class="special">;</span>

        <span class="identifier">CONTRACT_CLASS_TPL</span><span class="special">(</span> <span class="comment">// Nested (twice) class template with concepts.</span>
            <span class="keyword">private</span> <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
                <span class="identifier">requires</span><span class="special">(</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">DefaultConstructible</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="special">)</span>
            <span class="keyword">class</span> <span class="special">(</span><span class="identifier">bit</span><span class="special">)</span>
        <span class="special">)</span> <span class="special">{</span>
            <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>

            <span class="identifier">CONTRACT_CONSTRUCTOR_TPL</span><span class="special">(</span>
                <span class="keyword">public</span> <span class="special">(</span><span class="identifier">bit</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
                    <span class="identifier">initialize</span><span class="special">(</span> <span class="identifier">value_</span><span class="special">()</span> <span class="special">)</span>
            <span class="special">)</span> <span class="special">{}</span>

            <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
                <span class="keyword">public</span> <span class="keyword">void</span> <span class="special">(</span><span class="identifier">from_bool</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">bool</span> <span class="identifier">value</span> <span class="special">)</span>
                    <span class="identifier">postcondition</span><span class="special">(</span> <span class="identifier">to_bool</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">value</span> <span class="special">)</span>
            <span class="special">)</span> <span class="special">{</span>
                <span class="identifier">value_</span> <span class="special">=</span> <span class="identifier">value</span><span class="special">;</span>
            <span class="special">}</span>

            <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
                <span class="keyword">public</span> <span class="keyword">bool</span> <span class="special">(</span><span class="identifier">to_bool</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
            <span class="special">)</span> <span class="special">{</span>
                <span class="keyword">return</span> <span class="identifier">value_</span><span class="special">;</span>
            <span class="special">}</span>

            <span class="keyword">private</span><span class="special">:</span> <span class="identifier">T</span> <span class="identifier">value_</span><span class="special">;</span>
        <span class="special">};</span>

        <span class="identifier">CONTRACT_CONSTRUCTOR_TPL</span><span class="special">(</span>
            <span class="keyword">private</span> <span class="special">(</span><span class="identifier">reference</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
                <span class="identifier">postcondition</span><span class="special">(</span> <span class="identifier">bitptr_</span><span class="special">-&gt;</span><span class="identifier">to_bool</span><span class="special">()</span> <span class="special">==</span> <span class="keyword">int</span><span class="special">()</span> <span class="special">)</span>
                <span class="identifier">initialize</span><span class="special">(</span>
                    <span class="identifier">bitptr_</span><span class="special">(</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">bit</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;</span> <span class="special">&gt;(</span><span class="keyword">new</span> <span class="identifier">bit</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;()))</span>
                <span class="special">)</span>
        <span class="special">)</span> <span class="special">{}</span>

        <span class="identifier">CONTRACT_DESTRUCTOR_TPL</span><span class="special">(</span>
            <span class="keyword">public</span> <span class="special">(~</span><span class="identifier">reference</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
        <span class="special">)</span> <span class="special">{}</span>

        <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
            <span class="keyword">public</span> <span class="keyword">operator</span> <span class="keyword">bool</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
        <span class="special">)</span> <span class="special">{</span>
            <span class="keyword">return</span> <span class="identifier">bitptr_</span><span class="special">-&gt;</span><span class="identifier">to_bool</span><span class="special">();</span>
        <span class="special">}</span>

        <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
            <span class="keyword">public</span> <span class="special">(</span><span class="identifier">reference</span><span class="special">&amp;)</span> <span class="keyword">operator</span><span class="special">(=)(</span><span class="identifier">assign</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">bool</span> <span class="keyword">const</span> <span class="identifier">bit_value</span> <span class="special">)</span>
                <span class="identifier">postcondition</span><span class="special">(</span> <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span> <span class="identifier">result</span> <span class="special">==</span> <span class="special">*</span><span class="keyword">this</span> <span class="special">)</span>
        <span class="special">)</span> <span class="special">{</span>
            <span class="identifier">bitptr_</span><span class="special">-&gt;</span><span class="identifier">from_bool</span><span class="special">(</span><span class="identifier">bit_value</span><span class="special">);</span>
            <span class="keyword">return</span> <span class="special">*</span><span class="keyword">this</span><span class="special">;</span>
        <span class="special">}</span>

        <span class="keyword">private</span><span class="special">:</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">bit</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;</span> <span class="special">&gt;</span> <span class="identifier">bitptr_</span><span class="special">;</span>
    <span class="special">};</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="special">(</span><span class="identifier">reference</span><span class="special">)</span> <span class="keyword">operator</span><span class="special">([])(</span><span class="identifier">at</span><span class="special">)</span> <span class="special">(</span> <span class="identifier">size_t</span> <span class="identifier">index</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">index</span> <span class="special">&lt;</span> <span class="identifier">N</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">bitset_</span><span class="special">[</span><span class="identifier">index</span><span class="special">];</span>
    <span class="special">}</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">size_t</span> <span class="special">(</span><span class="identifier">size</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">N</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">reference</span> <span class="identifier">bitset_</span><span class="special">[</span><span class="identifier">N</span><span class="special">];</span>
<span class="special">};</span>
</pre>
<p>
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.friends"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.friends" title="Friends">Friends</a>
</h3></div></div></div>
<p>
        It is possible to program contracts for friend classes and friend functions.
        Classes can be declared friends and later contracted using the <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS.html" title="Macro CONTRACT_CLASS">CONTRACT_CLASS</a></code> macro as usual:
      </p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span> <span class="comment">// Not even necessary to contract this class.</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">x</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>

    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="identifier">y</span> <span class="special">;</span>

    <span class="comment">// ...</span>
<span class="special">};</span>

<span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">y</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>

    <span class="comment">// ...</span>
<span class="special">};</span>
</pre>
<p>
        Friend functions that are declared and defined within the enclosing class
        use the <code class="computeroutput"><span class="keyword">friend</span></code> keyword within
        the <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code> macro
        (note that the access level <code class="computeroutput"><span class="keyword">public</span></code>,
        <code class="computeroutput"><span class="keyword">protected</span></code>, or <code class="computeroutput"><span class="keyword">private</span></code> is optional in this case because these
        friend functions are not member functions). Friend functions that are either
        forward declared friends or that are defined friends within the enclosing
        class, must use the <code class="computeroutput"><a class="link" href="../CONTRACT_FREE_BODY.html" title="Macro CONTRACT_FREE_BODY">CONTRACT_FREE_BODY</a></code>
        macro. For example (see also <a href="../../../example/contracts/friend_counter.cpp" target="_top"><code class="literal">friend_counter.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span> <span class="comment">// Not even necessary to contract this class.</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span> <span class="identifier">requires</span><span class="special">(</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">CopyConstructible</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">counter</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span> <span class="identifier">value</span><span class="special">()</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">);</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span> <span class="comment">// Friend (contracted declaration and definition).</span>
        <span class="keyword">public</span> <span class="keyword">friend</span> <span class="special">(</span><span class="identifier">counter</span><span class="special">)</span> <span class="keyword">operator</span><span class="special">(/)(</span><span class="identifier">div</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">counter</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">left</span><span class="special">,</span>
                <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">right</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">right</span> <span class="special">&gt;</span> <span class="number">0</span> <span class="special">)</span> <span class="comment">// Strictly positive, cannot be zero.</span>
            <span class="identifier">postcondition</span><span class="special">(</span>
                <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
                <span class="identifier">result</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">*</span> <span class="identifier">right</span> <span class="special">==</span> <span class="identifier">left</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span>
            <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">counter</span><span class="special">(</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">/</span> <span class="identifier">right</span><span class="special">);</span>
    <span class="special">}</span>

    <span class="comment">// Friend forward declaration (contracted declaration and definition below).</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">template</span><span class="special">&lt;</span> <span class="keyword">typename</span> <span class="identifier">U</span> <span class="special">&gt;</span>
    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="identifier">CONTRACT_FREE_BODY</span><span class="special">(</span><span class="keyword">operator</span><span class="special">(==)(</span><span class="identifier">equal</span><span class="special">))</span> <span class="special">(</span> <span class="comment">// Use BODY.</span>
            <span class="identifier">counter</span><span class="special">&lt;</span><span class="identifier">U</span><span class="special">&gt;</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">left</span><span class="special">,</span> <span class="identifier">U</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span> <span class="special">;</span>

<span class="comment">// NOTE: Forward friend template instantiations give internal MSVC error.</span>
<span class="preprocessor">#if</span> <span class="identifier">defined</span><span class="special">(</span><span class="identifier">BOOST_MSVC</span><span class="special">)</span> <span class="special">&amp;&amp;</span> <span class="special">!</span><span class="identifier">defined</span><span class="special">(</span><span class="identifier">CONTRACT_CONFIG_NO_POSTCONDITIONS</span><span class="special">)</span>
    <span class="comment">// Friend definition (contracted declaration below).</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">friend</span> <span class="identifier">counter</span> <span class="identifier">CONTRACT_FREE_BODY</span><span class="special">(</span><span class="keyword">operator</span><span class="special">(*)(</span><span class="identifier">mult</span><span class="special">))</span> <span class="special">(</span> <span class="comment">// Use BODY.</span>
            <span class="identifier">counter</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">left</span><span class="special">,</span> <span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">right</span> <span class="special">)</span>
    <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">counter</span><span class="special">(</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">*</span> <span class="identifier">right</span><span class="special">);</span> <span class="comment">// Contract checked `right &gt;=0` .</span>
    <span class="special">}</span>
<span class="preprocessor">#endif</span>

    <span class="identifier">CONTRACT_CONSTRUCTOR_TPL</span><span class="special">(</span> <span class="comment">// Public constructor gets next counter value.</span>
        <span class="keyword">public</span> <span class="keyword">explicit</span> <span class="special">(</span><span class="identifier">counter</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
            <span class="identifier">initialize</span><span class="special">(</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">next_value_</span><span class="special">++)</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="identifier">CONTRACT_CONSTRUCTOR_TPL</span><span class="special">(</span> <span class="comment">// Private constructor.</span>
        <span class="keyword">private</span> <span class="keyword">explicit</span> <span class="special">(</span><span class="identifier">counter</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">a_value</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">a_value</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="identifier">value</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">a_value</span> <span class="special">)</span>
            <span class="identifier">initialize</span><span class="special">(</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">a_value</span><span class="special">)</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="identifier">CONTRACT_FUNCTION_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="special">(</span><span class="identifier">T</span><span class="special">)</span> <span class="special">(</span><span class="identifier">value</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">const</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>  <span class="identifier">result</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">value_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">T</span> <span class="identifier">value_</span><span class="special">;</span>
    <span class="keyword">private</span><span class="special">:</span> <span class="keyword">static</span> <span class="identifier">T</span> <span class="identifier">next_value_</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="identifier">T</span> <span class="identifier">counter</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">next_value_</span> <span class="special">=</span> <span class="identifier">T</span><span class="special">();</span>

<span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">U</span> <span class="special">)</span>
    <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">(==)(</span><span class="identifier">equal</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">counter</span><span class="special">&lt;</span><span class="identifier">U</span><span class="special">&gt;</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">left</span><span class="special">,</span> <span class="special">(</span><span class="identifier">U</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">right</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">right</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
            <span class="identifier">result</span> <span class="special">==</span> <span class="special">(</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">right</span><span class="special">)</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">return</span> <span class="identifier">left</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">right</span><span class="special">;</span>
<span class="special">}</span>

<span class="preprocessor">#if</span> <span class="identifier">defined</span><span class="special">(</span><span class="identifier">BOOST_MSVC</span><span class="special">)</span> <span class="special">&amp;&amp;</span> <span class="special">!</span><span class="identifier">defined</span><span class="special">(</span><span class="identifier">CONTRACT_CONFIG_NO_POSTCONDITIONS</span><span class="special">)</span>
<span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="special">(</span><span class="identifier">counter</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;)</span> <span class="keyword">operator</span><span class="special">(*)(</span><span class="identifier">mult</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">counter</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">left</span><span class="special">,</span>
            <span class="special">(</span><span class="keyword">int</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">right</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">right</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
            <span class="identifier">result</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">left</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">*</span> <span class="identifier">right</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">;</span>
<span class="preprocessor">#endif</span>
</pre>
<p>
      </p>
<p>
        The class enclosing the friend declarations might or might not be contracted.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.template_specializations"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.template_specializations" title="Template Specializations">Template
      Specializations</a>
</h3></div></div></div>
<p>
        It is possible to program contracts for class template specializations. The
        generic class template might or might not be contracted (see also <a href="../../../example/contracts/template_specializations_vector.cpp" target="_top"><code class="literal">template_specializations_vector.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span> <span class="comment">// Not even necessary to contract this template.</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">Allocator</span><span class="special">,</span> <span class="keyword">default</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">allocator</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">vector</span><span class="special">)</span> <span class="identifier">extends</span><span class="special">(</span> <span class="keyword">public</span> <span class="identifier">pushable</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="comment">// ...</span>
</pre>
<p>
      </p>
<p>
        The template specialization types follow the class name as usual but they
        are wrapped within round parenthesis <code class="computeroutput"><span class="special">(</span>
        <span class="keyword">bool</span><span class="special">,</span> <span class="identifier">Allocator</span> <span class="special">)</span></code>
        instead than angular parenthesis <code class="computeroutput"><span class="special">&lt;</span>
        <span class="keyword">bool</span><span class="special">,</span> <span class="identifier">Allocator</span> <span class="special">&gt;</span></code>
        as in the following partial specialization:
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span> <span class="comment">// Template specialization (one template parameter).</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">class</span> <span class="identifier">Allocator</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">vector</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">bool</span><span class="special">,</span> <span class="identifier">Allocator</span> <span class="special">)</span> <span class="identifier">extends</span><span class="special">(</span> <span class="keyword">public</span> <span class="identifier">pushable</span><span class="special">&lt;</span><span class="keyword">bool</span><span class="special">&gt;</span> <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="comment">// ...</span>
</pre>
<p>
      </p>
<p>
        The syntax <code class="computeroutput"><span class="keyword">template</span><span class="special">(</span>
        <span class="keyword">void</span> <span class="special">)</span></code>
        must be used instead of <code class="computeroutput"><span class="keyword">template</span><span class="special">&lt;</span> <span class="special">&gt;</span></code>
        to indicate explicit specializations:
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span> <span class="comment">// Template specialization (no template parameter).</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">vector</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">bool</span> <span class="special">)</span> <span class="identifier">extends</span><span class="special">(</span> <span class="keyword">public</span> <span class="identifier">pushable</span><span class="special">&lt;</span><span class="keyword">bool</span><span class="special">&gt;</span> <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="comment">// ...</span>
</pre>
<p>
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.exception_specifications_and_function_try_blocks"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.exception_specifications_and_function_try_blocks" title="Exception Specifications and Function-Try Blocks">Exception
      Specifications and Function-Try Blocks</a>
</h3></div></div></div>
<p>
        It is possible to program exception specifications and function-try blocks
        for constructors, destructors, member functions, and free functions with
        contracts. Exception specifications are part of the function declarations
        therefore they are programmed within the contract macros but the special
        syntax <code class="computeroutput"><span class="keyword">throw</span><span class="special">(</span>
        <span class="keyword">void</span> <span class="special">)</span></code>
        must be used instead of <code class="computeroutput"><span class="keyword">throw</span><span class="special">(</span> <span class="special">)</span></code> to specify
        that no exception is thrown:
      </p>
<pre class="programlisting"><span class="keyword">throw</span><span class="special">(</span> <span class="emphasis"><em>exception-type1</em></span><span class="special">,</span> <span class="emphasis"><em>exception-type2</em></span><span class="special">,</span> <span class="special">...</span> <span class="special">)</span> <span class="comment">// As usual.</span>
<span class="keyword">throw</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="comment">// Instead of `throw( )`.</span>
</pre>
<p>
        Function-try blocks are part of the function definition so they are normally
        programmed outside the contract macros. However, for constructors with member
        initializers, the member initializers must be programmed within the <code class="computeroutput"><a class="link" href="../CONTRACT_CONSTRUCTOR.html" title="Macro CONTRACT_CONSTRUCTOR">CONTRACT_CONSTRUCTOR</a></code> macro and therefore
        also the function-try blocks must be programmed within the macro using the
        following syntax:
      </p>
<pre class="programlisting"><span class="keyword">try</span> <span class="identifier">initialize</span><span class="special">(</span> <span class="emphasis"><em>initializer1</em></span><span class="special">,</span> <span class="emphasis"><em>initializer2</em></span><span class="special">,</span> <span class="special">...</span> <span class="special">)</span>
<span class="keyword">catch</span><span class="special">(</span><span class="emphasis"><em>exception-declaration1</em></span><span class="special">)</span> <span class="special">(</span> <span class="emphasis"><em>instruction1</em></span><span class="special">;</span> <span class="emphasis"><em>instruction2</em></span><span class="special">;</span> <span class="special">...</span> <span class="special">)</span>
<span class="keyword">catch</span><span class="special">(</span><span class="emphasis"><em>exception-declaration2</em></span><span class="special">)</span> <span class="special">(</span> <span class="emphasis"><em>instruction1</em></span><span class="special">;</span> <span class="emphasis"><em>instruction2</em></span><span class="special">;</span> <span class="special">...</span> <span class="special">)</span>
<span class="keyword">catch</span><span class="special">(...)</span> <span class="special">(</span> <span class="emphasis"><em>instruction1</em></span><span class="special">;</span> <span class="emphasis"><em>instruction2</em></span><span class="special">;</span> <span class="special">...</span> <span class="special">)</span>
</pre>
<p>
        As usual, only one catch statement must be specified and the other catch
        statements are optional plus <code class="computeroutput"><span class="keyword">catch</span><span class="special">(...)</span></code> can be used to catch all exceptions.
        Note however that round parenthesis <code class="computeroutput"><span class="special">(</span>
        <span class="special">...</span> <span class="special">)</span></code>
        are used instead of curly parenthesis <code class="computeroutput"><span class="special">{</span>
        <span class="special">...</span> <span class="special">}</span></code>
        to wrap the catch statement instructions (then the catch instructions are
        programmed with the usual syntax and separated by semicolons <code class="computeroutput"><span class="special">;</span></code>). (The maximum number of catch statements
        that can be programmed for constructor-try blocks is specified by the <code class="computeroutput"><a class="link" href="../CONTRACT_LIMIT_CONSTRUCTOR_TRY_BLOCK_CATCHES.html" title="Macro CONTRACT_LIMIT_CONSTRUCTOR_TRY_BLOCK_CATCHES">CONTRACT_LIMIT_CONSTRUCTOR_TRY_BLOCK_CATCHES</a></code>
        macro.)
      </p>
<p>
        In the following example the constructor uses a function-try block to throw
        only <code class="computeroutput"><span class="identifier">out_of_memory</span></code> and <code class="computeroutput"><span class="identifier">error</span></code> exceptions while the destructor uses
        exception specifications to throw no exception (see also <a href="../../../example/contracts/exception_array.cpp" target="_top"><code class="literal">exception_array.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">array</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT_TPL</span><span class="special">(</span> <span class="identifier">size</span><span class="special">()</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">struct</span> <span class="identifier">out_of_memory</span> <span class="special">{};</span>
    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">struct</span> <span class="identifier">error</span> <span class="special">{};</span>

    <span class="identifier">CONTRACT_CONSTRUCTOR_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">explicit</span> <span class="special">(</span><span class="identifier">array</span><span class="special">)</span> <span class="special">(</span> <span class="identifier">size_t</span> <span class="identifier">count</span> <span class="special">)</span>
            <span class="identifier">precondition</span><span class="special">(</span> <span class="identifier">count</span> <span class="special">&gt;=</span> <span class="number">0</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">count</span> <span class="special">)</span>
            <span class="comment">// Function try-blocks are programmed within the macros only for</span>
            <span class="comment">// constructors with member initializers otherwise they are</span>
            <span class="comment">// programmed with the body definitions and outside the macros.</span>
            <span class="keyword">try</span> <span class="identifier">initialize</span><span class="special">(</span> <span class="comment">// Try block for constructor initializers and body.</span>
                <span class="identifier">data_</span><span class="special">(</span><span class="keyword">new</span> <span class="identifier">T</span><span class="special">[</span><span class="identifier">count</span><span class="special">]),</span>
                <span class="identifier">size_</span><span class="special">(</span><span class="identifier">count</span><span class="special">)</span>
            <span class="comment">// Use `BOOST_IDENTITY_TYPE` if the exception type has unwrapped</span>
            <span class="comment">// commas or leading symbols.</span>
            <span class="special">)</span> <span class="keyword">catch</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">bad_alloc</span><span class="special">&amp;)</span> <span class="special">(</span>
                <span class="keyword">throw</span> <span class="identifier">out_of_memory</span><span class="special">();</span>
            <span class="special">)</span> <span class="keyword">catch</span><span class="special">(...)</span> <span class="special">(</span>
                <span class="keyword">throw</span> <span class="identifier">error</span><span class="special">();</span>
            <span class="special">)</span>
    <span class="special">)</span> <span class="special">{}</span>

    <span class="identifier">CONTRACT_DESTRUCTOR_TPL</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="special">(~</span><span class="identifier">array</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="keyword">throw</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span> <span class="comment">// Throw nothing.</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">delete</span><span class="special">[]</span> <span class="identifier">data_</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="comment">// ...</span>
</pre>
<p>
      </p>
<p>
        (The <code class="computeroutput"><span class="identifier">BOOST_IDENTITY_TYPE</span></code>
        macro can be used to wrap the catch statement exception declaration types
        if they contain unwrapped commas.)
      </p>
<p>
        Exception specifications and function-try blocks apply only to exceptions
        thrown by the function body and not to exceptions thrown by the contracts
        themselves (if any) and by the contract checking code generated by this library
        macros. <sup>[<a name="contract__.advanced_topics.exception_specifications_and_function_try_blocks.f0" href="#ftn.contract__.advanced_topics.exception_specifications_and_function_try_blocks.f0" class="footnote">52</a>]</sup>
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.specifying_types__no_boost_typeof_"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.specifying_types__no_boost_typeof_" title="Specifying Types (no Boost.Typeof)">Specifying
      Types (no Boost.Typeof)</a>
</h3></div></div></div>
<p>
        This library uses <a href="http://www.boost.org/doc/libs/release/libs/typeof" target="_top">Boost.Typeof</a>
        to automatically deduces postcondition old value types and constant assertion
        variable types. If programmers do not want the library to use <a href="http://www.boost.org/doc/libs/release/libs/typeof" target="_top">Boost.Typeof</a>
        they can explicitly specify these types.
      </p>
<p>
        The types of postcondition old values are specified instead of using <code class="computeroutput"><span class="keyword">auto</span></code> and they must be wrapped within round
        parenthesis unless they are fundamental types containing no symbol (these
        must match the type of the specified old-of expressions):
      </p>
<pre class="programlisting"><span class="special">(</span><span class="emphasis"><em>type</em></span><span class="special">)</span> <span class="emphasis"><em>variable</em></span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="emphasis"><em>oldof-expression</em></span>
</pre>
<p>
        The types of constant assertion variables are specified just before each
        variable name and they also must be wrapped within round parenthesis unless
        they are fundamental types containing no symbol:
      </p>
<pre class="programlisting"><span class="keyword">const</span><span class="special">(</span> <span class="special">(</span><span class="emphasis"><em>type1</em></span><span class="special">)</span> <span class="emphasis"><em>variable1</em></span><span class="special">,</span> <span class="special">(</span><span class="emphasis"><em>type2</em></span><span class="special">)</span> <span class="emphasis"><em>variable2</em></span><span class="special">,</span> <span class="special">...</span> <span class="special">)</span> <span class="emphasis"><em>boolean-expression</em></span>
</pre>
<p>
        For example (see also <a href="../../../example/contracts/typed_counter.cpp" target="_top"><code class="literal">typed_counter.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_CLASS</span><span class="special">(</span>
    <span class="keyword">class</span> <span class="special">(</span><span class="identifier">counter</span><span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_CLASS_INVARIANT</span><span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>

    <span class="keyword">public</span><span class="special">:</span> <span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="identifier">value</span><span class="special">;</span>

    <span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="special">(</span><span class="identifier">next</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
            <span class="identifier">postcondition</span><span class="special">(</span> <span class="comment">// Explicit types so no Boost.Typeof.</span>
                <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
                <span class="keyword">unsigned</span> <span class="keyword">const</span> <span class="identifier">old_value</span> <span class="special">=</span> <span class="identifier">CONTRACT_OLDOF</span> <span class="identifier">value</span><span class="special">,</span>
                <span class="keyword">const</span><span class="special">(</span> <span class="keyword">unsigned</span> <span class="identifier">value</span><span class="special">,</span> <span class="keyword">unsigned</span> <span class="keyword">const</span> <span class="identifier">old_value</span> <span class="special">)</span>
                        <span class="identifier">value</span> <span class="special">==</span> <span class="identifier">old_value</span> <span class="special">+</span> <span class="number">1</span><span class="special">,</span>
                <span class="identifier">result</span> <span class="special">==</span> <span class="keyword">int</span><span class="special">(</span><span class="identifier">value</span><span class="special">)</span>
            <span class="special">)</span>
    <span class="special">)</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="special">++</span><span class="identifier">value</span><span class="special">;</span>
    <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">unsigned</span> <span class="identifier">counter</span><span class="special">::</span><span class="identifier">value</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
</pre>
<p>
      </p>
<p>
        Note that postcondition result values are always specified using <code class="computeroutput"><span class="keyword">auto</span></code>:
      </p>
<pre class="programlisting"><span class="keyword">auto</span> <span class="emphasis"><em>result-variable</em></span> <span class="special">=</span> <span class="keyword">return</span>
</pre>
<p>
        This is because the function return type is know by the library as specified
        in the function declaration within the <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code>
        macro. Therefore, the postcondition result value type is never explicitly
        specified by programmers (but <a href="http://www.boost.org/doc/libs/release/libs/typeof" target="_top">Boost.Typeof</a>
        is never used to deduce it).
      </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          It is recommended to not specify these types explicitly and let the library
          internally use <a href="http://www.boost.org/doc/libs/release/libs/typeof" target="_top">Boost.Typeof</a>
          to deduce them because the library syntax is more readable without the
          explicit types. However, all types must be properly registered with <a href="http://www.boost.org/doc/libs/release/libs/typeof" target="_top">Boost.Typeof</a>
          as usual in order to use type-of emulation mode on <a href="http://en.wikipedia.org/wiki/C%2B%2B" target="_top">C++03</a>
          compilers that do not support native type-of (see <a href="http://www.boost.org/doc/libs/release/libs/typeof" target="_top">Boost.Typeof</a>
          for more information).
        </p></td></tr>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.block_invariants_and_loop_variants"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.block_invariants_and_loop_variants" title="Block Invariants and Loop Variants">Block
      Invariants and Loop Variants</a>
</h3></div></div></div>
<p>
        <span class="emphasis"><em>Block invariants</em></span> can be used anywhere within the function
        body and they are used to assert correctness conditions of the implementation
        (very much like <code class="computeroutput"><span class="identifier">assert</span></code>).
        They are programmed specifying a list of assertions to the <code class="computeroutput"><a class="link" href="../CONTRACT_BLOCK_INVARIANT.html" title="Macro CONTRACT_BLOCK_INVARIANT">CONTRACT_BLOCK_INVARIANT</a></code>
        macro (including static, constant, and select assertions):
      </p>
<pre class="programlisting"><span class="identifier">CONTRACT_BLOCK_INVARIANT</span><span class="special">(</span> <span class="emphasis"><em>assertion1</em></span><span class="special">,</span> <span class="emphasis"><em>assertion2</em></span><span class="special">,</span> <span class="special">...</span> <span class="special">)</span>
</pre>
<p>
        When block invariants are used within a loop, they are also called <span class="emphasis"><em>loop
        invariants</em></span> (e.g., <a href="http://en.wikipedia.org/wiki/Eiffel_(programming_language)" target="_top">Eiffel</a>
        uses this terminology).
      </p>
<p>
        Furthermore, this library allows to specify <a href="http://en.wikipedia.org/wiki/Loop_variant" target="_top"><span class="emphasis"><em>loop
        variants</em></span></a>. A loop variant is a non-negative monotonically
        decreasing number that is updated at each iteration of the loop. The specified
        loop variant expression is calculated by this library at each iteration of
        the loop and it is automatically asserted to be non-negative (<code class="computeroutput"><span class="special">&gt;=</span> <span class="number">0</span></code>) and
        to decrease monotonically from the previous loop iteration. Because the loop
        variant monotonically decreases and it cannot be smaller than zero, either
        the loop terminates or one of the two library assertions will eventually
        fail in which case the library will call the <code class="computeroutput"><a class="link" href="../contract/loop_variant_broken.html" title="Function loop_variant_broken">contract::loop_variant_broken</a></code>
        handler therefore detecting and stopping infinite loops. Each given loop
        can only have one variant which is specified using the <code class="computeroutput"><a class="link" href="../CONTRACT_LOOP_VARIANT.html" title="Macro CONTRACT_LOOP_VARIANT">CONTRACT_LOOP_VARIANT</a></code>
        macro. The enclosing loop (<code class="computeroutput"><span class="keyword">while</span></code>,
        <code class="computeroutput"><span class="keyword">for</span></code>, <code class="computeroutput"><span class="keyword">do</span></code>,
        etc) must be declared using the <code class="computeroutput"><a class="link" href="../CONTRACT_LOOP.html" title="Macro CONTRACT_LOOP">CONTRACT_LOOP</a></code>
        macro:
      </p>
<pre class="programlisting"><span class="identifier">CONTRACT_LOOP</span><span class="special">(</span> <span class="emphasis"><em>loop-declaration</em></span> <span class="special">)</span> <span class="special">{</span>
    <span class="identifier">CONTRACT_LOOP_VARIANT</span><span class="special">(</span> <span class="emphasis"><em>non-negative-monotonically-decreasing-expression</em></span> <span class="special">)</span>
    <span class="special">...</span>
<span class="special">}</span>
</pre>
<p>
        Note that the library cannot automatically make constant any of the variables
        within the function body therefore constant block invariant assertions and
        constant loop variant expressions should be used by programmers if they want
        to enforce constant-correctness for block invariants and loop variants.
      </p>
<p>
        The following example uses a loop to calculate the <a href="http://en.wikipedia.org/wiki/Greatest_common_divisor" target="_top">Greatest
        Common Divisor (GCD)</a> of two integral numbers (see also <a href="../../../example/contracts/blockinv_loopvar_gcd.cpp" target="_top"><code class="literal">blockinv_loopvar_gcd.cpp</code></a>):
      </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">template</span><span class="special">(</span> <span class="keyword">typename</span> <span class="identifier">T</span> <span class="special">)</span>
    <span class="special">(</span><span class="identifier">T</span><span class="special">)</span> <span class="special">(</span><span class="identifier">gcd</span><span class="special">)</span> <span class="special">(</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">a</span><span class="special">,</span> <span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;)</span> <span class="identifier">b</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span>
            <span class="identifier">static_assert</span><span class="special">(</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">is_integral</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span><span class="special">,</span> <span class="string">"integral type"</span><span class="special">),</span>
            <span class="identifier">a</span> <span class="special">!=</span> <span class="number">0</span><span class="special">,</span>
            <span class="identifier">b</span> <span class="special">!=</span> <span class="number">0</span>
        <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
            <span class="identifier">result</span> <span class="special">&lt;=</span> <span class="identifier">a</span><span class="special">,</span>
            <span class="identifier">result</span> <span class="special">&lt;=</span> <span class="identifier">b</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="identifier">T</span> <span class="identifier">x</span> <span class="special">=</span> <span class="identifier">a</span><span class="special">,</span> <span class="identifier">y</span> <span class="special">=</span> <span class="identifier">b</span><span class="special">;</span>
    <span class="comment">// Block invariant assert conditions within body,</span>
    <span class="identifier">CONTRACT_BLOCK_INVARIANT_TPL</span><span class="special">(</span> <span class="keyword">const</span><span class="special">(</span> <span class="identifier">x</span><span class="special">,</span> <span class="identifier">a</span> <span class="special">)</span> <span class="identifier">x</span> <span class="special">==</span> <span class="identifier">a</span><span class="special">,</span> <span class="keyword">const</span><span class="special">(</span> <span class="identifier">y</span><span class="special">,</span> <span class="identifier">b</span> <span class="special">)</span> <span class="identifier">y</span> <span class="special">==</span> <span class="identifier">b</span> <span class="special">)</span>

    <span class="identifier">CONTRACT_LOOP</span><span class="special">(</span> <span class="keyword">while</span><span class="special">(</span><span class="identifier">x</span> <span class="special">!=</span> <span class="identifier">y</span><span class="special">)</span> <span class="special">)</span> <span class="special">{</span> <span class="comment">// Define a loop with variants (below).</span>
        <span class="comment">// Block invariant for loops (i.e., loop invariants).</span>
        <span class="identifier">CONTRACT_BLOCK_INVARIANT_TPL</span><span class="special">(</span> <span class="keyword">const</span><span class="special">(</span> <span class="identifier">x</span> <span class="special">)</span> <span class="identifier">x</span> <span class="special">&gt;</span> <span class="number">0</span><span class="special">,</span> <span class="keyword">const</span><span class="special">(</span> <span class="identifier">y</span> <span class="special">)</span> <span class="identifier">y</span> <span class="special">&gt;</span> <span class="number">0</span> <span class="special">)</span>
        <span class="comment">// Loop variant checked to be non-negative and monotonically decreasing.</span>
        <span class="identifier">CONTRACT_LOOP_VARIANT_TPL</span><span class="special">(</span> <span class="keyword">const</span><span class="special">(</span> <span class="identifier">x</span><span class="special">,</span> <span class="identifier">y</span> <span class="special">)</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">max</span><span class="special">(</span><span class="identifier">x</span><span class="special">,</span> <span class="identifier">y</span><span class="special">)</span> <span class="special">)</span>

        <span class="keyword">if</span><span class="special">(</span><span class="identifier">x</span> <span class="special">&gt;</span> <span class="identifier">y</span><span class="special">)</span> <span class="identifier">x</span> <span class="special">=</span> <span class="identifier">x</span> <span class="special">-</span> <span class="identifier">y</span><span class="special">;</span>
        <span class="keyword">else</span> <span class="identifier">y</span> <span class="special">=</span> <span class="identifier">y</span> <span class="special">-</span> <span class="identifier">x</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="keyword">return</span> <span class="identifier">x</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        <a href="http://en.wikipedia.org/wiki/Eiffel_(programming_language)" target="_top">Eiffel</a>
        supports loop variants but <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a> does
        not. Loop variants might not be very useful especially if <a href="http://www.boost.org/doc/libs/release/libs/foreach" target="_top">Boost.Foreach</a>
        or similar constructs are used to ensure loop termination.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="contract__.advanced_topics.contract_broken_handlers__throw_on_failure_"></a><a class="link" href="advanced_topics.html#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_" title="Contract Broken Handlers (Throw on Failure)">Contract
      Broken Handlers (Throw on Failure)</a>
</h3></div></div></div>
<p>
        When a contract assertion fails, this library prints a message on the standard
        error <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">cerr</span></code> and it terminates the program calling
        <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">terminate</span></code>. Programmers can change this
        behavior customizing the actions that the library takes on contract assertion
        failure by setting the contract broken handler functions. By default the
        library terminates the program because a contract failure indicates that
        the program is in an invalid state that programmers specified it should never
        happen (so the only sensible assumption is that the program execution should
        not continue). However, in some cases programmers might need to handle even
        such catastrophic failures by executing some fail-safe code instead of terminating
        the program and that can be done customizing the contract broken handlers.
      </p>
<p>
        The library functions <code class="computeroutput"><a class="link" href="../reference.html#contract.set_precondition_broken">contract::set_precondition_broken</a></code>,
        <code class="computeroutput"><a class="link" href="../reference.html#contract.set_postcondition_broken">contract::set_postcondition_broken</a></code>,
        <code class="computeroutput"><a class="link" href="../reference.html#contract.set_class_invariant_broken">contract::set_class_invariant_broken</a></code>,
        <code class="computeroutput"><a class="link" href="../reference.html#contract.set_block_invariant_broken">contract::set_block_invariant_broken</a></code>,
        and <code class="computeroutput"><a class="link" href="../reference.html#contract.set_loop_variant_broken">contract::set_loop_variant_broken</a></code>
        can be used to customize the action to taken in case of precondition, postcondition,
        class invariant, block invariant, and loop variant failure respectively.
        Furthermore, class invariants are checked at entry, at normal exit, and at
        exit but when exceptions are thrown so more granular handlers can be set
        for each of these cases using <code class="computeroutput"><a class="link" href="../reference.html#contract.set_class_invaria_id488551">contract::set_class_invariant_broken_on_entry</a></code>,
        <code class="computeroutput"><a class="link" href="../reference.html#contract.set_class_invaria_id488629">contract::set_class_invariant_broken_on_exit</a></code>,
        and <code class="computeroutput"><a class="link" href="../reference.html#contract.set_class_invaria_id488707">contract::set_class_invariant_broken_on_throw</a></code>
        (using <code class="computeroutput"><a class="link" href="../reference.html#contract.set_class_invariant_broken">contract::set_class_invariant_broken</a></code>
        is equivalent to setting all these class invariant broken handles to the
        same handler). <sup>[<a name="contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f0" href="#ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f0" class="footnote">53</a>]</sup>
      </p>
<p>
        This library passes a parameter of type <code class="computeroutput"><a class="link" href="../contract/from.html" title="Type from">contract::from</a></code>
        to the contract broken handler functions indicating the context that failed
        the contract assertion (e.g., this parameter will be set to <code class="computeroutput"><span class="identifier">contract</span><span class="special">::</span><span class="identifier">FROM_DESTRUCTOR</span></code> if the contract assertion
        failed from a destructor): <sup>[<a name="contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f1" href="#ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f1" class="footnote">54</a>]</sup>
      </p>
<pre class="programlisting"><span class="keyword">void</span> <span class="emphasis"><em>contract-broken-handler</em></span> <span class="special">(</span> <span class="identifier">contract</span><span class="special">::</span><span class="identifier">from</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">context</span> <span class="special">)</span>
</pre>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="../../../doc/src/images/important.png"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>
          In order to comply with the STL exception safety requirements, destructors
          should never throw. Therefore, even if programmers customize the contract
          broken handlers to throw exceptions instead of terminating, the handlers
          should never throw when contract assertions fail from a destructor (and
          the <code class="computeroutput"><a class="link" href="../contract/from.html" title="Type from">contract::from</a></code> parameter
          can be used to discriminate this case).
        </p></td></tr>
</table></div>
<p>
        The contract broken handlers are always invoked with an active exception
        that refers to the exception that failed the contract: <sup>[<a name="contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f2" href="#ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f2" class="footnote">55</a>]</sup>
      </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
            Either an exception that was explicitly thrown by the user from the contract
            (e.g. <code class="computeroutput"><span class="identifier">not_a_number</span></code> in
            the example blow).
          </li>
<li class="listitem">
            Or, an exception that was thrown <span class="quote">&#8220;<span class="quote">behind the scene</span>&#8221;</span> while
            evaluating a contract assertion (e.g., the assertion calls an STL algorithm
            and that throws <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">bad_alloc</span></code>).
          </li>
<li class="listitem">
            Or, an exception automatically thrown by this library in case a contract
            assertion is evaluated to be false (these exceptions are always <code class="computeroutput"><a class="link" href="../contract/broken.html" title="Class broken">contract::broken</a></code> objects and they
            contained detailed information about the contract assertion that was
            evaluated to be false: file name, line number, assertion number, and
            assertion code). <sup>[<a name="contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f3" href="#ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f3" class="footnote">56</a>]</sup>
          </li>
</ol></div>
<p>
        In all these cases the contract assertion is considered failed because it
        was not evaluated to be true (and that is the case not only for assertions
        that are evaluated to be false but also for assertions that throw exceptions
        while being evaluated). <sup>[<a name="contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f4" href="#ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f4" class="footnote">57</a>]</sup> The customized contract broken handlers can re-throw the active
        exception and catch it so to inspect it for logging or for any other customized
        behaviour that might need to be implemented by the programmers.
      </p>
<p>
        The following example customizes the contract broken handlers to throw exceptions
        (both user-defined exceptions like <code class="computeroutput"><span class="identifier">not_a_number</span></code>
        and the <code class="computeroutput"><a class="link" href="../contract/broken.html" title="Class broken">contract::broken</a></code> exception
        that the library automatically throws in case of a contract assertion failure).
        However, the customized handlers never throw from within a destructor to
        comply with STL exception safety requirements (see also <a href="../../../example/contracts/broken_handler_sqrt.cpp" target="_top"><code class="literal">broken_handler_sqrt.cpp</code></a>):
        <sup>[<a name="contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f5" href="#ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f5" class="footnote">58</a>]</sup>
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">struct</span> <span class="identifier">not_a_number</span> <span class="special">{};</span> <span class="comment">// User defined exception.</span>

<span class="identifier">CONTRACT_FUNCTION</span><span class="special">(</span>
    <span class="keyword">double</span> <span class="special">(</span><span class="identifier">sqrt</span><span class="special">)</span> <span class="special">(</span> <span class="keyword">double</span> <span class="identifier">x</span> <span class="special">)</span>
        <span class="identifier">precondition</span><span class="special">(</span>
            <span class="identifier">x</span> <span class="special">&gt;=</span> <span class="number">0.0</span> <span class="special">?</span> <span class="keyword">true</span> <span class="special">:</span> <span class="keyword">throw</span> <span class="identifier">not_a_number</span><span class="special">()</span> <span class="comment">// Throw user exception.</span>
        <span class="special">)</span>
        <span class="identifier">postcondition</span><span class="special">(</span>
            <span class="keyword">auto</span> <span class="identifier">root</span> <span class="special">=</span> <span class="keyword">return</span><span class="special">,</span>
            <span class="identifier">root</span> <span class="special">*</span> <span class="identifier">root</span> <span class="special">==</span> <span class="identifier">x</span> <span class="comment">// Failure throws `contract::broken` exception.</span>
        <span class="special">)</span>
<span class="special">)</span> <span class="special">{</span>
    <span class="keyword">return</span> <span class="number">0.0</span><span class="special">;</span> <span class="comment">// Intentionally incorrect to fail postcondition.</span>
<span class="special">}</span>

<span class="keyword">void</span> <span class="identifier">throwing_handler</span> <span class="special">(</span> <span class="identifier">contract</span><span class="special">::</span><span class="identifier">from</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">context</span> <span class="special">)</span>
<span class="special">{</span>
    <span class="comment">// Failure handlers always called with active exception that failed the</span>
    <span class="comment">// contract, so re-throw it to catch it below for logging.</span>
    <span class="keyword">try</span> <span class="special">{</span>
        <span class="keyword">throw</span><span class="special">;</span>
    <span class="special">}</span> <span class="keyword">catch</span><span class="special">(</span><span class="identifier">contract</span><span class="special">::</span><span class="identifier">broken</span><span class="special">&amp;</span> <span class="identifier">failure</span><span class="special">)</span> <span class="special">{</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">cerr</span> <span class="special">&lt;&lt;</span> <span class="identifier">failure</span><span class="special">.</span><span class="identifier">file_name</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">"("</span> <span class="special">&lt;&lt;</span> <span class="identifier">failure</span><span class="special">.</span><span class="identifier">line_number</span><span class="special">()</span> <span class="special">&lt;&lt;</span>
                <span class="string">"): contract assertion \""</span> <span class="special">&lt;&lt;</span> <span class="identifier">failure</span><span class="special">.</span><span class="identifier">assertion_code</span><span class="special">()</span> <span class="special">&lt;&lt;</span>
                <span class="string">"\" failed "</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span> <span class="keyword">catch</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">exception</span><span class="special">&amp;</span> <span class="identifier">failure</span><span class="special">)</span> <span class="special">{</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">cerr</span> <span class="special">&lt;&lt;</span> <span class="string">"contract failed: "</span> <span class="special">&lt;&lt;</span> <span class="identifier">failure</span><span class="special">.</span><span class="identifier">what</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span> <span class="keyword">catch</span><span class="special">(...)</span> <span class="special">{</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">cerr</span> <span class="special">&lt;&lt;</span> <span class="string">"contract failed with unknown error"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span>

    <span class="comment">// Cannot throw from destructors to comply with STL exception safety,</span>
    <span class="comment">// otherwise re-throw active exception that failed the contract.</span>
    <span class="keyword">if</span><span class="special">(</span><span class="identifier">context</span> <span class="special">==</span> <span class="identifier">contract</span><span class="special">::</span><span class="identifier">FROM_DESTRUCTOR</span><span class="special">)</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">cerr</span> <span class="special">&lt;&lt;</span> <span class="string">"Ignoring destructor contract failure (probably "</span>
            <span class="special">&lt;&lt;</span> <span class="string">"something bad has happened)"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="keyword">else</span> <span class="keyword">throw</span><span class="special">;</span> <span class="comment">// Never terminates.</span>
<span class="special">}</span>

<span class="keyword">int</span> <span class="identifier">main</span> <span class="special">(</span> <span class="keyword">void</span> <span class="special">)</span>
<span class="special">{</span>
    <span class="comment">// Customize contract broken handlers to throw exceptions instead of</span>
    <span class="comment">// terminating the program (default).</span>
    <span class="identifier">contract</span><span class="special">::</span><span class="identifier">set_precondition_broken</span><span class="special">(&amp;</span><span class="identifier">throwing_handler</span><span class="special">);</span>
    <span class="identifier">contract</span><span class="special">::</span><span class="identifier">set_postcondition_broken</span><span class="special">(&amp;</span><span class="identifier">throwing_handler</span><span class="special">);</span>

<span class="preprocessor">#ifndef</span> <span class="identifier">CONTRACT_CONFIG_NO_PRECONDITIONS</span>
    <span class="keyword">bool</span> <span class="identifier">pre</span> <span class="special">=</span> <span class="keyword">false</span><span class="special">;</span>
    <span class="keyword">try</span> <span class="special">{</span>
        <span class="identifier">sqrt</span><span class="special">(-</span><span class="number">1.0</span><span class="special">);</span> <span class="comment">// Fails precondition.</span>
    <span class="special">}</span> <span class="keyword">catch</span><span class="special">(</span><span class="identifier">not_a_number</span><span class="special">&amp;)</span> <span class="special">{</span>
        <span class="identifier">pre</span> <span class="special">=</span> <span class="keyword">true</span><span class="special">;</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">clog</span> <span class="special">&lt;&lt;</span> <span class="string">"Ignoring not-a-number exception"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span>
    <span class="identifier">BOOST_TEST</span><span class="special">(</span><span class="identifier">pre</span><span class="special">);</span>
<span class="preprocessor">#endif</span>

<span class="preprocessor">#ifndef</span> <span class="identifier">CONTRACT_CONFIG_NO_POSTCONDITIONS</span>
    <span class="keyword">bool</span> <span class="identifier">post</span> <span class="special">=</span> <span class="keyword">false</span><span class="special">;</span>
    <span class="keyword">try</span> <span class="special">{</span>
        <span class="identifier">sqrt</span><span class="special">(</span><span class="number">4.0</span><span class="special">);</span> <span class="comment">// Fails postcondition.</span>
    <span class="special">}</span> <span class="keyword">catch</span><span class="special">(...)</span> <span class="special">{</span>
        <span class="identifier">post</span> <span class="special">=</span> <span class="keyword">true</span><span class="special">;</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">clog</span> <span class="special">&lt;&lt;</span> <span class="string">"Unable to calculate square root"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span>
    <span class="identifier">BOOST_TEST</span><span class="special">(</span><span class="identifier">post</span><span class="special">);</span>
<span class="preprocessor">#endif</span>

    <span class="keyword">return</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">report_errors</span><span class="special">();</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        Note how the ternary operator <code class="computeroutput"><span class="special">:?</span></code>
        can be used to program assertions that throw exceptions on failure:
      </p>
<pre class="programlisting"><span class="identifier">x</span> <span class="special">&gt;=</span> <span class="number">0.0</span> <span class="special">?</span> <span class="keyword">true</span> <span class="special">:</span> <span class="keyword">throw</span> <span class="identifier">not_a_number</span>
</pre>
<p>
        Then the contract broken handlers are customized to propagate the exceptions
        instead of handling them by calling <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">terminate</span></code>
        (default behaviour).
      </p>
<p>
        See also <a href="../../../example/contracts/contract_failure.cpp" target="_top"><code class="literal">contract_failure.cpp</code></a> for
        a more complex example that redefines the contract broken handlers to throw
        exceptions in order to automatically check that the correct contract broken
        handlers are called when assertions fail in accordance with the call semantics
        explained in the <a class="link" href="contract_programming_overview.html" title="Contract Programming Overview">Contract
        Programming Overview</a> section.
      </p>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.commas_and_leading_symbols_in_macros.f0" href="#contract__.advanced_topics.commas_and_leading_symbols_in_macros.f0" class="para">35</a>] </sup>
          Note that for the preprocessor a number with decimal period <code class="computeroutput"><span class="number">1.23</span></code>, <code class="computeroutput"><span class="number">0.12</span></code>,
          <code class="computeroutput"><span class="special">.</span><span class="number">34</span></code>
          is considered a symbol (because its concatenation will not result in a
          valid macro identifier).
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.commas_and_leading_symbols_in_macros.f1" href="#contract__.advanced_topics.commas_and_leading_symbols_in_macros.f1" class="para">36</a>] </sup>
            <span class="bold"><strong>Rationale.</strong></span> This limitation is introduced
            by the need to support also the sequence syntax for preprocessor without
            variadic macros (see the <a class="link" href="no_variadic_macros.html" title="No Variadic Macros">No
            Variadic Macros</a> section).
          </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.static_assertions.f0" href="#contract__.advanced_topics.static_assertions.f0" class="para">37</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> <a href="http://en.wikipedia.org/wiki/Eiffel_(programming_language)" target="_top">Eiffel</a>
          supports <span class="emphasis"><em>assertion labeling</em></span> to further documenting
          assertions. However, when designing this library for C++, the authors judged
          that it is sufficient to add a short code comment after each assertion
          to achieve a similar effect.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.constant_assertions.f0" href="#contract__.advanced_topics.constant_assertions.f0" class="para">38</a>] </sup>
            <span class="bold"><strong>Rationale.</strong></span> The library needs to know
            at least the variable name in order to make it constant. There is no
            way for this library to know the name of a global variable that is implicitly
            accessible from the contract assertion scope so such a variable cannot
            be automatically made constant. Non-static data members are automatically
            made constant by making constant the member function that checks the
            contract, but that does not apply to static data members. Not even <a href="http://en.wikipedia.org/wiki/C%2B%2B11" target="_top">C++11</a> lambda implicit
            captures could be used in this context because they make variables constant
            only when captured by value and that introduces a <a href="http://www.boost.org/doc/libs/release/libs/utility/CopyConstructible.html" target="_top"><code class="literal">CopyConstructible</code></a>
            requirement of the captured variable types.
          </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.assertion_statements.f0" href="#contract__.advanced_topics.assertion_statements.f0" class="para">39</a>] </sup>
          Assertion statements might be especially useful because contracts appear
          with the class and function declarations usually in header files where
          <code class="computeroutput"><span class="keyword">using</span></code> directives and <code class="computeroutput"><span class="keyword">namespace</span></code> aliases should only be used with
          extreme care and, for example, at local scope as assertion statements allow
          to do.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.assertion_requirements.f0" href="#contract__.advanced_topics.assertion_requirements.f0" class="para">40</a>] </sup>
              <span class="bold"><strong>Rationale.</strong></span> The assertion requirement
              syntax takes a constant boolean expression instead of a nullary boolean
              meta-function because the authors have found no reason to use a meta-function
              in this context. Furthermore, constant boolean expressions can be manipulated
              via the usual operators <code class="computeroutput"><span class="keyword">not</span></code>,
              <code class="computeroutput"><span class="keyword">and</span></code>, etc, therefore more
              naturally than boolean meta-functions which need to use <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">mpl</span><span class="special">::</span><span class="identifier">not_</span></code>, <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">mpl</span><span class="special">::</span><span class="identifier">and_</span></code>,
              etc instead.
            </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.assertion_requirements.f1" href="#contract__.advanced_topics.assertion_requirements.f1" class="para">41</a>] </sup>
          Future revisions of this library might provide wrappers that program contracts
          for the STL in appropriate header files <code class="literal">contract/std/vector.hpp</code>,
          <code class="literal">contract/std/algorithm.hpp</code>, etc (see also <a href="http://www.sgi.com/tech/stl/" target="_top">SGI
          STL</a> and <a href="http://sourceforge.net/apps/trac/contractpp/ticket/47" target="_top">Ticket
          47</a>). However, given that STL implementations are usually considered
          to be <span class="quote">&#8220;<span class="quote">correct</span>&#8221;</span>, it is not clear if STL class invariants and
          postconditions would add any value, maybe programmers would only find STL
          preconditions useful.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.assertion_requirements.f2" href="#contract__.advanced_topics.assertion_requirements.f2" class="para">42</a>] </sup>
          Assertion requirements where first introduced by this library and they
          are not supported by <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>, <a href="http://dlang.org" target="_top">D</a>, or <a href="http://en.wikipedia.org/wiki/Eiffel_(programming_language)" target="_top">Eiffel</a>
          (even if they all allow to write contracts for templates). Based on the
          authors' experience, assertion requirements are necessary for a language
          that make extensive use of templates like C++. Furthermore, C++ does not
          automatically define equality operators <code class="computeroutput"><span class="special">==</span></code>
          while it automatically defines copy constructors and that make the use
          of the assertion requirements for <a href="http://www.sgi.com/tech/stl/EqualityComparable.html" target="_top"><code class="literal">EqualityComparable</code></a>
          a rather common practise (in <a href="http://en.wikipedia.org/wiki/Eiffel_(programming_language)" target="_top">Eiffel</a>
          instead types can be both copied and compared for equality by default).
          It has been argued that it is not possible to check a program for correctness
          if types that are copyable cannot also be compared for equality and the
          authors experience with programming contracts confirms such an argument.
        </p></div>
<div class="footnote">
<p><sup>[<a id="ftn.contract__.advanced_topics.assertion_requirements.f3" href="#contract__.advanced_topics.assertion_requirements.f3" class="para">43</a>] </sup>
          As of <a href="http://www.boost.org" target="_top">Boost</a> 1.50, <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span></code> and similar traits always
          return true for an STL container even if the value type of the container
          does not have an operator <code class="computeroutput"><span class="special">==</span></code>.
          This is arguably a defect of the STL that always defines an operator <code class="computeroutput"><span class="special">==</span></code> for its containers even when a container
          template is instantiated with a value type that has no operator <code class="computeroutput"><span class="special">==</span></code>, in which case the container operator
          <code class="computeroutput"><span class="special">==</span></code> will produce a compiler
          error (the STL should instead use <a href="http://en.wikipedia.org/wiki/Substitution_failure_is_not_an_error" target="_top">SFINAE</a>
          to disable the declaration of the container operator <code class="computeroutput"><span class="special">==</span></code>
          when the value type has no operator <code class="computeroutput"><span class="special">==</span></code>).
          Future versions of <a href="http://www.boost.org/doc/libs/release/libs/type_traits" target="_top">Boost.TypeTraits</a>
          will probably specialize <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">has_equal_to</span></code>
          and similar traits to work around this behaviour of the STL. In the meanwhile,
          programmers can specialize these traits themselves if needed:
</p>
<pre class="programlisting"><span class="comment">// Header: std_has_equal_to.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">type_traits</span><span class="special">/</span><span class="identifier">has_equal_to</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">type_traits</span><span class="special">/</span><span class="identifier">is_convertible</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">mpl</span><span class="special">/</span><span class="keyword">and</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">vector</span><span class="special">&gt;</span>

<span class="comment">// STL defines `operator==` only between two identical containers (same value</span>
<span class="comment">// type, allocator, etc) and returning a type convertible to `bool`.</span>

<span class="keyword">namespace</span> <span class="identifier">boost</span> <span class="special">{</span>

<span class="comment">// Specializations for `std::vector`.</span>

<span class="keyword">template</span><span class="special">&lt;</span> <span class="keyword">typename</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">Alloc</span> <span class="special">&gt;</span>
<span class="keyword">struct</span> <span class="identifier">has_equal_to</span> <span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;</span> <span class="special">&gt;</span> <span class="special">:</span>
    <span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">&gt;</span>
<span class="special">{};</span>

<span class="keyword">template</span><span class="special">&lt;</span> <span class="keyword">typename</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">Alloc</span><span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">Ret</span> <span class="special">&gt;</span>
<span class="keyword">struct</span> <span class="identifier">has_equal_to</span> <span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">Alloc</span><span class="special">&gt;,</span> <span class="identifier">Ret</span> <span class="special">&gt;</span> <span class="special">:</span>
    <span class="identifier">mpl</span><span class="special">::</span><span class="identifier">and_</span><span class="special">&lt;</span>
          <span class="identifier">has_equal_to</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">&gt;</span>
        <span class="special">,</span> <span class="identifier">is_convertible</span><span class="special">&lt;</span><span class="identifier">Ret</span><span class="special">,</span> <span class="keyword">bool</span><span class="special">&gt;</span>
    <span class="special">&gt;</span>
<span class="special">{};</span>

<span class="comment">// ... specialize `has_equal_to` for more STL containers.</span>

<span class="special">}</span> <span class="comment">// namespace</span>
</pre>
<p>
        </p>
</div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.assertion_requirements.f4" href="#contract__.advanced_topics.assertion_requirements.f4" class="para">44</a>] </sup>
          <a class="link" href="bibliography.html#N1866_anchor">[N1866]</a>, an earlier version of <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>, introduced the notion of <span class="emphasis"><em>importance
          ordering</em></span> that could be used to selectively disable assertions
          that where too expensive computationally. Important ordering was then dropped
          by <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>. Among other things, assertion
          requirements can be used to achieve the importance ordering functionality.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.old_of_requirements.f0" href="#contract__.advanced_topics.old_of_requirements.f0" class="para">45</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> The result type needs to be
          copyable in order for the function itself to return a value so this library
          can always evaluate return value declarations.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.old_and_result_value_copies.f0" href="#contract__.advanced_topics.old_and_result_value_copies.f0" class="para">46</a>] </sup>
          Currently, it is not possible to force constant-correctness of the expression
          passed to the <code class="computeroutput"><a class="link" href="../CONTRACT_OLDOF.html" title="Macro CONTRACT_OLDOF">CONTRACT_OLDOF</a></code>
          macro. Future revisions of this library will support <code class="computeroutput"><span class="identifier">CONTRACT_OLDOF</span>
          <span class="keyword">const</span><span class="special">(</span>
          <span class="special">...</span> <span class="special">)</span>
          <span class="special">...</span></code> to allow to make constant all
          variables (including global, static, etc) used by old value expressions
          (see also <a href="http://sourceforge.net/apps/trac/contractpp/ticket/52" target="_top">Ticket
          52</a>).
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.pure_virtual_functions.f0" href="#contract__.advanced_topics.pure_virtual_functions.f0" class="para">47</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> Older revisions of this library
          defined the macro <code class="computeroutput"><span class="identifier">CONTRACT_MEMBER_BODY</span><span class="special">(</span><span class="identifier">class_type</span><span class="special">,</span> <span class="identifier">function_name</span><span class="special">)</span></code> taking two parameters so this macro could
          not be used in declaring derived classes and the <code class="computeroutput"><a class="link" href="../CONTRACT_CLASS.html" title="Macro CONTRACT_CLASS">CONTRACT_CLASS</a></code>
          and <code class="computeroutput"><a class="link" href="../CONTRACT_FUNCTION.html" title="Macro CONTRACT_FUNCTION">CONTRACT_FUNCTION</a></code> macros
          where required when programming a class inheriting from a base class with
          contracts. However, the authors prefer to leave the choice of programming
          full contracts for derived classes to the derived class programmers because
          of the unusual declaration syntax introduced by this library might not
          be necessary when derived classes do not need to alter the base's class
          contract.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.static_member_functions.f0" href="#contract__.advanced_topics.static_member_functions.f0" class="para">48</a>] </sup>
          Static class invariants are not part of <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>
          and they were first introduced by this library.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.volatile_member_functions.f0" href="#contract__.advanced_topics.volatile_member_functions.f0" class="para">49</a>] </sup>
          Volatile class invariants are not part of <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>
          and they were first introduced by this library. It is not clear if there
          are real applications for volatile class invariants mainly because real
          applications of <code class="computeroutput"><span class="keyword">volatile</span></code> itself
          are not clear in C++. One very interesting use of <code class="computeroutput"><span class="keyword">volatile</span></code>
          has been to <a href="http://www.drdobbs.com/cpp/184403766" target="_top">avoid race
          conditions</a> in concurrent programming (but contracts are not useful
          for such an application of <code class="computeroutput"><span class="keyword">volatile</span></code>).
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.operators.f0" href="#contract__.advanced_topics.operators.f0" class="para">50</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> The comma operator cannot be
          specified using the comma symbol as in <code class="computeroutput"><span class="keyword">operator</span><span class="special">(,)(</span><span class="identifier">my_comma_operator</span><span class="special">)</span></code> because the preprocessor uses commas to
          separate macro parameters so it is not possible to distinguish that from
          an implicit type conversion operator like <code class="computeroutput"><span class="keyword">operator</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">Allocator</span><span class="special">&gt;)(</span><span class="identifier">std_vector</span><span class="special">)</span></code> (note that the operator name is arbitrary
          so it also cannot be used to distinguish these two cases).
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.operators.f1" href="#contract__.advanced_topics.operators.f1" class="para">51</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> C++ automatically promotes
          memory member operators to static members so the <code class="computeroutput"><span class="keyword">static</span></code>
          keyword is optional for these member operators. However, this library cannot
          inspect the operator symbol using the preprocessor to check if the operator
          is a memory member operator or not because the symbol contains non-alphanumeric
          tokens (which cannot be concatenated by the preprocessor). Therefore, this
          library always requires memory member operators to be explicitly declared
          as static member functions.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.exception_specifications_and_function_try_blocks.f0" href="#contract__.advanced_topics.exception_specifications_and_function_try_blocks.f0" class="para">52</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>
          specifies that function-try blocks should only apply to the body code and
          not to the contract code. No explicit requirement is stated in <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>
          for exception specifications but the authors have decided to adopt the
          same requirement that applies to function-try blocks (because it seemed
          of little use for the contract to throw an exception just so it is handled
          by the exception specification).
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f0" href="#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f0" class="para">53</a>] </sup>
          <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a> does not allow to configure
          class invariant broken handlers differently for entry, exit, and throw.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f1" href="#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f1" class="para">54</a>] </sup>
          The <code class="computeroutput"><span class="identifier">contract</span><span class="special">::</span><span class="identifier">from</span></code> parameter was not part of <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a> contract broken handlers but the
          proposal hinted that it might be needed (need that was confirmed by the
          implementation of this library).
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f2" href="#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f2" class="para">55</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> Exceptions are used to signal
          a contract assertion failure because it is not possible to directly call
          the contract broken handler (<code class="computeroutput"><a class="link" href="../contract/precondition_broken.html" title="Function precondition_broken">contract::precondition_broken</a></code>,
          etc) instead of throwing the exception in oder to properly implement subcontracting.
          For example, if an overriding precondition fails but the overridden precondition
          is true then the library will not call the broken handler even if the overriding
          precondition threw an exception (as required by subcontracting). Contract
          assertion failures are critical error conditions so it is actually natural
          that the library uses exceptions to signal them (note that the library
          will always handle the exceptions by calling the contract broken handlers
          which terminate the program by default so the fact that the library signals
          contract assertion failures using exceptions does not imply that an exception
          will be thrown if a contract assertion fails, that is entirely decided
          by the implementation of the broken handlers).
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f3" href="#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f3" class="para">56</a>] </sup>
              The assertion number is meaningful only within a specific handler.
              For example, if assertion number <code class="computeroutput"><span class="number">2</span></code>
              failed within the class invariant broken handler that mean that the
              class invariant number <code class="computeroutput"><span class="number">2</span></code>
              failed. Therefore, the assertion number is not useful if a single handler
              is programmed for all types of contracts because such an handler can
              no longer distinguish between class invariants, preconditions, postconditions,
              etc.
            </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f4" href="#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f4" class="para">57</a>] </sup>
          <span class="bold"><strong>Rationale.</strong></span> Threating an exception thrown
          while evaluating an assertion as a failure of the contract assertion is
          a clear policy established by this library under the principle that a contract
          assertion fails unless it is evaluated to be true. <a class="link" href="bibliography.html#N1962_anchor">[N1962]</a>
          does not completely clarify this point.
        </p></div>
<div class="footnote"><p><sup>[<a id="ftn.contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f5" href="#contract__.advanced_topics.contract_broken_handlers__throw_on_failure_.f5" class="para">58</a>] </sup>
          In this example, contract failures from destructors are logged and then
          simply ignored. That might be acceptable in this simple example but it
          is probably a very bad idea in general.
        </p></div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2008-2012 Lorenzo Caminiti<p>
        Distributed under the Boost Software License, Version 1.0 (see accompanying
        file LICENSE_1_0.txt or a copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tutorial.html"><img src="../../..//doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../..//doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../..//doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="virtual_specifiers.html"><img src="../../..//doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
